<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Affects on the R package of the Patentsview API changes announced in
2021 • patentsview</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



  <link href="extra.css" rel="stylesheet">
  

<meta property="og:title" content="Affects on the R package of the Patentsview API changes announced in
2021" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">patentsview</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-flag"></span>
     
    API Changes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/api-changes.html">
        <span class="fas fa-exclamation"></span>
         
        2022 API Changes
      </a>
    </li>
    <li>
      <a href="articles/converting-an-existing-script.html">
        <span class="fas fa-sync"></span>
         
        Converting an Existing Script
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="articles/getting-started.html">
    <span class="fas fa-play"></span>
     
    Getting started
  </a>
</li>
<li>
  <a href="articles/writing-queries.html">
    <span class="fas fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li>
  <a href="articles/examples.html">
    <span class="fas fa-code"></span>
     
    Examples
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-bar-chart"></span>
     
    Applications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/top-assignees.html">
        <span class="fas fa-university"></span>
         
        Top assignees
      </a>
    </li>
    <li>
      <a href="articles/citation-networks.html">
        <span class="fas fa-long-arrow-left"></span>
         
        Citation networks
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="reference/index.html">
    <span class="fas fa-info-circle"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/patentsview">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Affects on the R package of the Patentsview API changes announced in
2021</h1>
    </div>

<div id="affects-on-the-r-package-of-the-patentsview-api-changes-announced-in-2021" class="section level1">

<p>(This is <a href="https://github.com/mustberuss/patentsview/blob/api-change-2021/api-changes-2021.md">api-changes-2021.md</a>
with navigation to the updated vignettes and reference pages.)</p>
<blockquote>
<p>   “Let’s not bicker and argue about who killed who”.<br>
          From Monty Python and Holy Grail</p>
</blockquote>
<p>I wasn’t sure what the githubby way to do this would be but this page
chronicles the work done so far, the choices made along the way and what
is still outstanding. Whether some of this could or should be issues or
a project, in either this repo or its parent’s could be debated, or
maybe we should find a better way to bicker! (properly discuss the right
way to change the R package.) Or maybe slug it all out in an epic, one
for the ages, pull request?</p>
<div id="important-notes" class="section level2">
<h2 class="hasAnchor">
<a href="#important-notes" class="anchor"></a>Important Notes</h2>
<ol>
<li>The locations endpoint is not on the test server yet.</li>
<li>More endpoints are coming by the end of 2022, rumored to include one
for application data.</li>
</ol>
</div>
<div id="required-further-reading" class="section level2">
<h2 class="hasAnchor">
<a href="#required-further-reading" class="anchor"></a>Required Further Reading:</h2>
<p>(Keep reading, they’re not prerequisites to reading this page)</p>
<ol>
<li>The <a href="https://patentsview.org/data-in-action/whats-new-patentsview-july-2021">announcement</a>
of the API changes.</li>
<li>The new and modified vignettes (use the nav above).</li>
<li>The new and modified <a href="https://github.com/mustberuss/patentsview/tree/api-change-2021/tests/testthat">test
cases</a>.</li>
</ol>
</div>
<div id="favorable-api-changes" class="section level2">
<h2 class="hasAnchor">
<a href="#favorable-api-changes" class="anchor"></a>Favorable API Changes</h2>
<ol>
<li><p>The API team has produced a <a href="https://search.patentsview.org/swagger-ui/">Swagger UI page</a>
for the new version of the API! It has flaws but it’s a start and is
something I’ve been lobbying for since the launch of the API. If you
aren’t familiar with Swagger UI, it’s like an online version of Postman,
preloaded to use a particular API. The underlying Swagger/OpenAPI object
should comprehensively specify everything that the API is capable of
doing, its verbs, inputs, outputs and errors. In other words, its the
whole shebang if done properly. The underlying object can even be
imported into Postman or used as input to other opensource projects, as
mentioned <a href="#swagger-101-1">below</a>.</p></li>
<li>
<p>In the new version of the API all fields are supposed to be
quaryable. (Searching by cpc fields on the test server’s patents
endpoint is currently broken.) From the bottom of <a href="https://patentsview.org/apis/purpose">this page</a>, referring to
the new <a href="https://search.patentsview.org/swagger-ui/">Swagger UI
page</a>:</p>
<blockquote>
<p>Please refer to the 200 “Response” section for each endpoint for full
list of fields available. All the available fields are “queryable.”</p>
</blockquote>
</li>
<li><p>The API now returns most non strings as their appropriate type,
integer or float. It looks like now casting should only have to create R
dates from the string dates that are received. There are a couple of
exceptions that I’ve opened as bugs, like assignees_at_grant.type from
the patents endpoint, it’s still a string when it should be an
int</p></li>
</ol>
</div>
<div id="general-upheaval" class="section level2">
<h2 class="hasAnchor">
<a href="#general-upheaval" class="anchor"></a>General Upheaval</h2>
<p>The villagers may revolt over some of these API changes…      Or, the
R package will become even more useful and relevant and there will be a
parade.</p>
<ol>
<li><p>The overall paged result set size limit is now 10,000, down from
100,000 (see the <a href="articles/converting-an-existing-script.html">converting-an-existing-script
vignette</a>).</p></li>
<li><p>The size/per_page maximum on a single request changes from 10,000
to 1,000. Maximum check and message changed in validate-args.R, it could
or should throw a warning when per_page is set above 1,000 and send to
API as 1,000.<br></p></li>
<li><p>A lot of fields seem to have gone away, like the governmental
interests ones. Some, but not all, are lists in the Discontinued Fields
section of <a href="https://patentsview.org/data-in-action/whats-new-patentsview-july-2021">this
page</a>. The swagger definition (<a href="https://search.patentsview.org/static/openapi_v2.yml" class="uri">https://search.patentsview.org/static/openapi_v2.yml</a>)
does not contain government interest fields, ipc fields, wipo fields,
lawyer fields, foreign_priority fields, examiner fields, pct fields, raw
inventor fields, coinventor fields, patent_firstnamed fields or
patent_num_claims. Assuming all these fields are going away, though
more, unspecified, endpoints are supposed to be coming before the end of
2022.</p></li>
<li>
<p>The options matched_subentities_only and
include_subentity_total_counts seem to have gone away, but they don’t
seem to throw errors when requested. The R package should probably throw
an error or warning when set, the behavior of an old script may be
different than what the user expects. From <a href="https://patentsview.org/api-v01-information-page" class="uri">https://patentsview.org/api-v01-information-page</a></p>
<blockquote>
<p>Owing to de-normalized and split API design, sub-entity information
is not available directly via each endpoint. As a consequence,
“matched_subentity” option parameters are not valid.</p>
</blockquote>
</li>
<li><p>Some attributes have new names, like name_last in the nested
inventor object returned from the patents endpoint. Now in the fields
parameter it would be specified as “inventor.name_last” where formerly
it was “inventor_last_name” when using the patents endpoint and
name_last when hitting the assignees endpoint (where it comes back at
the top level, not within an nested object).</p></li>
<li><p>There are type changes in some of the attributes, affecting which
query methods are used, contains vs test_any etc. organization (formerly
the string assignee_organization) is now a full text field. I need to
confirm this, but it seems that most fields are now full text.
Exceptions seem to be in the patents endpoint.<br></p></li>
<li><p>The uspc and nber fields do not currently come back from the
patents endpoint. Now there is no real point to call the uspc or nber
endpoints. This means there is no way to search for patents using the
uspc or nber fields.</p></li>
<li><p>The cited_patent and citedby_patent fields no longer can come
back from the patents endpoint, instead the new patent_citations
endpoint needs to be called. Similarily, the appcit_app fields come only
from the new application_citation endpoint.</p></li>
</ol>
</div>
<div id="r-package-design-choices" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package-design-choices" class="anchor"></a>R Package Design Choices</h2>
<ol>
<li>
<strong>Changes made in search-pv.R</strong>
<ol>
<li>An API key is now required. The <a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">best
practices page</a> said to create an environmental variable for this.
The environmental variable’s name, PATENTSVIEW_API_KEY, is the same one
I used in my unadopted fork of the API’s python wrapper <a href="https://github.com/mustberuss/PatentsView-APIWrapper/tree/api-change-2022" class="uri">https://github.com/mustberuss/PatentsView-APIWrapper/tree/api-change-2022</a>
</li>
<li>The patentsview API team has made the 13 endpoints singular, patent
instead of patents, but the returned data structures remain plural. The
R package will continue to use the plural endpoint names as they match
the returned data structure and going singular caused casting problems.
It also helps with backward compatibility.</li>
<li>The API’s paging attribute names changed from page and per_page to
offset and size. It seemed best to hide this from users. The R package
will still use page and per_page and convert when sending requests to
the API. offset = (page-1) * per_page and size = per_page<br>
</li>
<li>Another API change makes the default return size 100, up from 25.
For backward compatibility it seemed like a good idea to leave the
default of per_page at 25 in search-pv.R.</li>
<li>Throttling will be imposed. An http status of 429 “Too many
requests” will be returned if more than 45 requests are received per
minute. The Retry-After header will specify the number of seconds to
wait before sending the next request. search-pv sleeps the required
seconds (rather than always doing a Sys.sleep(3)) and then resends the
same request to hide this change from the user. It does throw a warning
and prints a message which could be changed.</li>
<li>An API change says that POST requests will need to send JSON data
(instead of string representation of JSON). A Content-Type:
application/json header was added.</li>
<li>It seemed like a good idea to set per_page = 1000 when all_pages ==
TRUE, minimizing API calls if when the user left it at the default or
other size. I added a slighly wonky way to suppress this, so the paging
test case can compare paged and non paged results of a small result
set.</li>
<li>The subdomain domain and pattern of the endpoints are
changing.<br>
existing<br>
  <a href="https://api.patentsview.org/cpc_subsections/query?q=" class="uri">https://api.patentsview.org/cpc_subsections/query?q=</a><br>
new<br>
  <a href="https://search.patentsview.org/api/v1/cpc_subsection/?q=" class="uri">https://search.patentsview.org/api/v1/cpc_subsection/?q=</a><br>
</li>
<li>The ceiling calcuation changed and there are similar changes in
process-resp.R as the data comes back in a different order than before.
Now the order is<br><code>error (boolean), count, total_hits, data</code><br>
while it used to be<br><code>data, count, total_&lt;endpoint&gt;_count</code><br>
Also note that total_hits comes back from all endpoints, previously
there was an endpoint specific return, like total_patent_count</li>
<li>The API now returns a few HATEOAS (Hypermedia as the Engine of
Application State) links to retrieve more information, example
“inventor”: “<a href="https://search.patentsview.org/api/v1/inventor/252373/" class="uri">https://search.patentsview.org/api/v1/inventor/252373/</a>”
(Clicking the link will result in a 403 Unauthorized - no API key is
sent by a browser) Added <a href="reference/retrieve_linked_data.html">retrieve_linked_data()</a> to
retrieve this data for the user, they’d pass the full url.</li>
</ol>
</li>
<li>
<strong>General Choices</strong>
<ol>
<li><p>Now there are new, get-only convience endpoints that take a url
parameter. The R package ignores these and just uses the ones that do
posts and gets using q,f,s and o parameters, as the original version of
the API did.</p></li>
<li><p>The online documentation is lagging. The two new endpoints are
documented on <a href="https://patentsview.org/data-in-action/whats-new-patentsview-july-2021" class="uri">https://patentsview.org/data-in-action/whats-new-patentsview-july-2021</a>
but they’re missing the Query column (all fields queryable now). Pages
for the other endpoint haven’t been changed yet. I created fake pages
for data-raw/mbr_fieldsdf.R to consume. They’re on a site I control <a href="https://patentsview.historicip.com/api/" class="uri">https://patentsview.historicip.com/api/</a>. In the fake
pages, “integer” fields get cast as_is while “int” fields (integers
still sent as strings) get cast as.integer.</p></li>
<li><p>As an alternative to scraping the fake pages just mentioned, I
created data-raw/yml_extract.R to try to create the csv by parsing the
API’s Swagger definition.</p></li>
<li><p>Now only 3 of the 13 endpoints are searchable by patent number,
which affected a few of the test cases. I wound up adding
R/test-helpers.R to generate a test query per endpoint. Initially I had
it as tests/testthat/helper-queries.R but I thought that caused the
ubuntu-20.04 build failure.</p></li>
<li><p>I set my API key as asecret in my repo so tests will run and the
vignettes can be half rendered etc. It’s retrieved in R-CMD-check.yaml
which might need to be removed if we don’t need to do this.</p></li>
<li><p>I had to add dev = “png” to the knitr::opts_chunk$set in
citation-networks.Rmd.orig to get it to render locally.</p></li>
<li><p>See the new vignette <a href="articles/converting-an-existing-script.html#additions-to-the-r-package-1">converting-an-existing-script.html#additions-to-the-r-package-1</a>
I wrote a function that uses the API to determine date ranges for a
query returning more than 10,000 rows. I think it should be added to the
R package, but I wasn’t sure if it’s a good idea..</p></li>
<li><p>Because of the singular endpoint name change, I added the
following to utils.R to_plural() and to_singular() Not saying I’m
whatever the R equivalent is to a pythonic python programmer…</p></li>
<li><p>I added an inclusive qry_funs$in_range() to try to make it easier
for users to break up queries, due to the decrease in overall request
size.</p></li>
</ol>
<pre><code>qry_funs$in_range("patent_date"=c("2000-01-07","2000-01-28")
{"_and":[{"_gte":{"patent_date":"2000-01-07"}},{"_lte":{"patent_date":"2000-01-28"}}]}</code></pre>
</li>
</ol>
</div>
<div id="try-it-out-for-yourself" class="section level2">
<h2 class="hasAnchor">
<a href="#try-it-out-for-yourself" class="anchor"></a>Try it out for yourself</h2>
<p>Steps to try this out locally</p>
<ol>
<li>Request an API key from the patentsview team <a href="https://patentsview.org/apis/keyrequest" class="uri">https://patentsview.org/apis/keyrequest</a>
</li>
<li>Set the environmental variable PATENTSVIEW_API_KEY value to your
key.<br>
ex: set PATENTSVIEW_API_KEY=your_key_here (Windows)</li>
<li>Install the patentsview package from mustberuss’ api-change-2021
branch
<code><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">devtools::install_github("mustberuss/patentsview@api-change-2021")</a></code>
</li>
</ol>
</div>
<div id="notes" class="section level2">
<h2 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h2>
<ol>
<li><p><a href="https://patentsview.historicip.com/swagger/openapi_v2.yml" class="uri">https://patentsview.historicip.com/swagger/openapi_v2.yml</a>
can be imported into Postman to give you a nicely loaded collection for
the changed API. You’ll just need to set a global variable PVIEW_KEY and
set the authorization’s value to {{PVIEW_KEY}}. The patentview team’s
Swagger definition has reported errors that make importing it
problematic.</p></li>
<li>
<p>The swagger definition shows a X-Status-Reason-Code in addition
to the existing X-Status-Reason. Not sure it matters to or would be
useful for the r package. It doesn’t seem to add anything useful.
~~~~</p>
<blockquote>
<p>print(httr::headers(resp)[[‘X-Status-Reason’]]) [1] “Invaild field:
shoe_size” print(httr::headers(resp)[[‘X-Status-Reason-Code’]]) [1]
“ERR_Q” ~~~~</p>
</blockquote>
</li>
<li><p>There seems to be a change in case sensitivity compared to the
original API. The original API would return results for
q:{“patent_type”:“Design”} while the ElasticSearch version does
not.</p></li>
<li><p>It probably won’t not matter to the R package but the slash in
the url parameters of /api/v1/uspc_subclass/{uspc_subclass_id}/ and
/api/v1/cpc_subgroup/{cpc_subgroup_id}/ need to be changed to colons,
ex. 100:1 for 100/1 and A01B1:00 for A01B1/00 and respectively. This can
be seen in the return from the patent endpoint’s
cpc_current.cpc_subgroup, example “<a href="https://search.patentsview.org/api/v1/cpc_subgroup/G01S7:4865/" class="uri">https://search.patentsview.org/api/v1/cpc_subgroup/G01S7:4865/</a>”
(Clicking the link will result in a 403 Unauthorized - no API key is
sent by a browser.) It’s a HATEOAS style link that conatins a colon
instead of a slash.</p></li>
<li><p>The API seems like it will become less useful. A lot of use cases
will break, like the ones lists on <a href="https://docs.ropensci.org/patentsview/articles/examples.html" class="uri">https://docs.ropensci.org/patentsview/articles/examples.html</a></p></li>
</ol>
</div>
<div id="todos" class="section level2">
<h2 class="hasAnchor">
<a href="#todos" class="anchor"></a>TODOS</h2>
<ol>
<li><p>Some exampes may not be possible due to the API change, like
searching inventors by location. (locations endpoint is not on the test
server yet.) There a bogus locations test in test-search-pv.R that
should be reworked or removed.</p></li>
<li><p>Have a search-pv option to automatically retrieve these HATEOAS
links if all_pages is FALSE? Would be closer to the original version of
the API if this data was added automatically. (Would need to check the
data to see if this would be useful.)</p></li>
<li><p>Or in cast-pv-data offer an option to strip off the HATEOAS
links? Is this meaningful to the user: “cpc_subgroup”: “<a href="https://search.patentsview.org/api/v1/cpc_subgroup/G01S7:4811/" class="uri">https://search.patentsview.org/api/v1/cpc_subgroup/G01S7:4811/</a>”
(Clicking the link will result in a 403 Unauthorized - no API key is
sent by a browser) or do they just want the value G01S7:4811 or even
G01S7/4811?</p></li>
<li><p>Test that what comes back from the API calls matches the
spreadsheet and/or their Swagger definition (should be ultimate source
of truth). There’s a “API Update Table” link to the fields spreadsheet
at the very bottom of <a href="https://patentsview.org/apis/purpose" class="uri">https://patentsview.org/apis/purpose</a> test-api-returns.R
currently checks that all the groups come back, it could be extended to
include all fields.</p></li>
<li><p>Check if the location specific error checking is still needed
(throw_if_loc_error() in process-error.R). The locations endpoint won’t
return as many fields as before but it’s not on the test server yet. The
locations tab in the spreadsheet just mentiomend don’t look
right.</p></li>
<li><p>It would be helpful if a test could be written to test the
searchability of string/full text fields. In other words, to we have the
types right in the fake documentation? Confirm that we can do a
_text_any on all the fields we think are full text and _contains on all
the ones we think are strings.</p></li>
<li><p>We probably should remove printing of the url to stderr in
search-pv but it’s been so darn useful durning development</p></li>
<li><p>Add a method that would iterate through the data ranges generated
by tell_us (in the <a href="articles/converting-an-existing-script.html">converting-an-existing-script
vignette</a>) and return the concatenated results. Or just wrap the
whole thing, user passes in the query, we call tell_us and give them
back the combined data set.</p></li>
<li>
<p>We probably don’t need this in process-error.R though the
location endpoint is not on the test server yet</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span class="st">"Your request resulted in a 500 error, likely because you have "</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="st">"requested too many fields in your request (the locations endpoint "</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a> <span class="st">"currently has restrictions on the number of fields/groups you can "</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a> <span class="st">"request). Try slimming down your field list and trying again."</span></span></code></pre></div>
</li>
<li><p>If possible, suppress api-changes-2021.md from producing
docs/api-changes-2021.html</p></li>
<li><p>Clean up utils.R I hadn’t noticed until writting test-utils.R
that only to_singular is used by the package. to_plural() isn’t used,
it’s a hold over from a failed attempt at making the endpoints
singular.</p></li>
<li><p>A followup is probably in order for the <a href="https://ropensci.org/blog/2017/09/19/patentsview/">rOpenSci blog
post</a> There’s an unlinked vignette that reworks the code so it
“works” using the new version of the api. README.md’s link should be
changed if there is a new post.</p></li>
</ol>
</div>
<div id="questions" class="section level2">
<h2 class="hasAnchor">
<a href="#questions" class="anchor"></a>Questions</h2>
<ol>
<li>Should we bump the version number to 0.4.0 or 1.0.0? The API key
alone quarantees that the package won’t be backward compatible.</li>
<li>Are there any other fields changing type? (like assignee
organization becoming a full text field, formerly it had been a
string)</li>
<li>Are there more fields (like the government interests) that went
away?</li>
<li>How to handle the release? For a while both versions of the API are
supposed to be around. Have people install the updated R package from a
branch on ropensci/patentsview? When the original version of the API is
retired do a CRAN build?</li>
<li>Possible idea: ask the patentsview people if they could create a
separate category for the R package in their forum? Guessing people may
need help with their conversions!</li>
</ol>
</div>
<div id="swagger-101" class="section level2">
<h2 class="hasAnchor">
<a href="#swagger-101" class="anchor"></a>Swagger 101</h2>
<p>Open my version of the Swagger object for the new version of the API
in the <a href="https://editor.swagger.io/?url=https://patentsview.historicip.com/swagger/openapi_v2.yml">Swagger
Editor</a> then “Generate Client-r” or one of html ones. Pretty powerful
huh? There are also numerous tools <a href="https://openapi.tools/">here</a> that will do fun things with a
Swagger object as input but nothing seems to be R based. I did find this
that looks promising on <a href="https://cran.r-project.org/web/packages/rapiclient/rapiclient.pdf">cran</a>
or <a href="https://github.com/bergant/rapiclient">github</a>. One
gotcha, it expects the input file to be the older Swagger 2.0 format. It
works but throws a warning. It looks like what we really need is an R
port of this python project <a href="https://github.com/cyprieng/swagger-parser" class="uri">https://github.com/cyprieng/swagger-parser</a>! Oops, that’s
reading Swagger 2 files. All that to say that there isn’t something to
generate fieldsdf.csv from the Swagger definition, we’ll have to do some
heavy lifting ourselves.</p>
</div>
<div id="carried-over" class="section level2">
<h2 class="hasAnchor">
<a href="#carried-over" class="anchor"></a>Carried Over</h2>
<p>Observations from the original version of the R package that are
still true in this version.</p>
<ol>
<li>Paging isn’t quite right, it repeats the first request if all_pages
= TRUE, slight improvement opportunity.</li>
<li>The search field has to be explicitly specified in the f: parameter
when a sort field is specified. The API does have default fields that
could be sorted on, without specifying in the f: parameter. A script
could make API calls to see what the default fields are. Probably isn’t
worth the effort, and it’s not necessarily an improvement! (it’s just an
observation)</li>
<li>The screenshot of the highcharter plot in the top-assignees vignette
is incomplete. The png only shows a little bit of IBM’s yearly patents,
not the full awesomeness of highcharter’s plot. The line graph in the
roensci blog looks fine, how was that one done?    </li>
</ol>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p>Developed by Christopher Baker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


