<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="patentsview">
<title>API Paging • patentsview</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="API Paging">
<meta property="og:description" content="patentsview">
<meta property="og:image" content="https://mustberuss.github.io/patentsview/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">patentsview</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--api-changes">
    <span class="fa fa-flag"></span>
     
    API Changes
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--api-changes">
    <a class="dropdown-item" href="../articles/api-changes.html">
      <span class="fa fa-exclamation"></span>
       
      2024 API Changes
    </a>
    <a class="dropdown-item" href="../articles/converting-an-existing-script.html">
      <span class="fa fa-sync"></span>
       
      Converting an Existing Script
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started.html">
    <span class="fa fa-play"></span>
     
    Getting started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/writing-queries.html">
    <span class="fa fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--applications">
    <span class="fa fa-bar-chart"></span>
     
    Applications
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--applications">
    <a class="dropdown-item" href="../articles/examples.html">
      <span class="fa fa-code"></span>
       
      Examples
    </a>
    <a class="dropdown-item" href="../articles/top-assignees.html">
      <span class="fa fa-university"></span>
       
      Top assignees
    </a>
    <a class="dropdown-item" href="../articles/citation-networks.html">
      <span class="fa fa-long-arrow-left"></span>
       
      Citation networks
    </a>
    <a class="dropdown-item" href="../articles/ropensci_blog_post.html">
      <span class="fa fa-bullhorn"></span>
       
      ropensci announcement
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/patentsview/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>API Paging</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/patentsview/blob/HEAD/vignettes/api-paging.Rmd" class="external-link"><code>vignettes/api-paging.Rmd</code></a></small>
      <div class="d-none name"><code>api-paging.Rmd</code></div>
    </div>

    
    
<p>Paging changed in the new version of the Patentsview API. This
vignette tries to explain a subtle gotcha that the R package handles for
you and to show how to do your own paging. Or it’s trying to make the
case for adding a max_rows parameter to search_pv()!</p>
<p>The R package lets you make a single request of up to 1000 rows or to
retrieve all rows, with nothing in between, unless you do your own
paging. This might be important if you want to retrieve a few thousand
utility patents without retrieving all 8 million of them. If you do your
own paging, you’ll need to be careful when choosing your sort field, as
shown in Example 2.</p>
<div class="section level2">
<h2 id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h2>
<p>Here we’ll retrieve 5000 utility patents by paging.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mustberuss.github.io/patentsview/index.html">patentsview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Lets get 5000 utility patents, 1000 at a time (the API's maximum rows per request)</span></span>
<span><span class="va">requested_rows</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">sort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_id"</span> <span class="op">=</span> <span class="st">"asc"</span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">eq</span><span class="op">(</span><span class="st">"patent_type"</span> <span class="op">=</span> <span class="st">"utility"</span><span class="op">)</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_id"</span>, <span class="st">"patent_date"</span>, <span class="st">"patent_title"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The "after" parameter is explained a bit lower.  It's an Elasticsearch thing,</span></span>
<span><span class="co"># which is the attrbute the new version of the API uses to page.  For now, just be </span></span>
<span><span class="co"># thankful that the R package handles this for you when you set all_pages = TRUE</span></span>
<span><span class="va">after</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"page"</span>, <span class="va">n</span>, <span class="st">"after is"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">after</span><span class="op">)</span>,<span class="st">"NULL"</span>,<span class="va">after</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">page_n</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">query</span>, fields <span class="op">=</span> <span class="va">fields</span>, sort <span class="op">=</span> <span class="va">sort</span>, </span>
<span>    all_pages <span class="op">=</span> <span class="cn">FALSE</span>, size <span class="op">=</span> <span class="va">requested_rows</span>, after <span class="op">=</span> <span class="va">after</span><span class="op">)</span></span>
<span>   <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sort</span><span class="op">)</span></span>
<span>   <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">page_n</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>   <span class="va">after</span> <span class="op">&lt;&lt;-</span> <span class="va">page_n</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">s</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "page 1 after is NULL"</span></span>
<span><span class="co">#&gt; [1] "page 2 after is 10001014"</span></span>
<span><span class="co">#&gt; [1] "page 3 after is 10002021"</span></span>
<span><span class="co">#&gt; [1] "page 4 after is 10003025"</span></span>
<span><span class="co">#&gt; [1] "page 5 after is 10004043"</span></span>
<span></span>
<span><span class="va">utility_patents</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">as.data.frame</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">utility_patents</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    5000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;  $ patents.patent_id   : chr  "10000000" "10000001" "10000002" "10000003" ...</span></span>
<span><span class="co">#&gt;  $ patents.patent_title: chr  "Coherent LADAR using intra-pixel quadrature detection" "Injection molding machine and mold thickness control method" "Method for manufacturing polymer film and co-extruded film" "Method for producing a container from a thermoplastic" ...</span></span>
<span><span class="co">#&gt;  $ patents.patent_date : chr  "2018-06-19" "2018-06-19" "2018-06-19" "2018-06-19" ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h2>
<p>Here we will execute a query two different ways, the first having the
R package do the paging, the second will be our misguided attempt to do
the paging ourselves.</p>
<p>uspto says <span class="citation">@PD</span>&gt;=19760101&lt;=19760131 is 6003
patents<br>
pv says 5352</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_id"</span>, <span class="st">"patent_date"</span>, <span class="st">"patent_title"</span><span class="op">)</span></span>
<span><span class="va">sort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_date"</span> <span class="op">=</span> <span class="st">"asc"</span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">in_range</span><span class="op">(</span>patent_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1976-01-01"</span>, <span class="st">"1976-01-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">query</span></span>
<span><span class="co">#&gt; {"_and":[{"_gte":{"patent_date":"1976-01-01"}},{"_lte":{"patent_date":"1976-01-31"}}]}</span></span>
<span><span class="co">#&gt; {"_and":[{"_gte":{"patent_date":"1976-01-01"}},{"_lte":{"patent_date":"1976-01-31"}}]}</span></span>
<span></span>
<span><span class="va">r_pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">query</span>, sort <span class="op">=</span> <span class="va">sort</span>, fields <span class="op">=</span> <span class="va">fields</span>, all_pages <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note the number of rows returned</span></span>
<span><span class="va">r_pkg</span><span class="op">$</span><span class="va">query_results</span><span class="op">$</span><span class="va">total_hits</span></span>
<span><span class="co">#&gt; [1] 5352</span></span></code></pre></div>
<p>Now we’ll try to do our own paging but as you might notice, we’ll run
into trouble.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mustberuss.github.io/patentsview/index.html">patentsview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">after</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">requested_rows</span> <span class="op">&lt;-</span> <span class="fl">1000</span>  <span class="co"># API's maximum rows per request</span></span>
<span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_id"</span>, <span class="st">"patent_date"</span>, <span class="st">"patent_title"</span><span class="op">)</span></span>
<span><span class="va">sort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_date"</span> <span class="op">=</span> <span class="st">"asc"</span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">in_range</span><span class="op">(</span>patent_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1976-01-01"</span>, <span class="st">"1976-01-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">query</span></span>
<span><span class="co">#&gt; {"_and":[{"_gte":{"patent_date":"1976-01-01"}},{"_lte":{"patent_date":"1976-01-31"}}]}</span></span>
<span></span>
<span><span class="co"># We'll continue to make requests until we get back an empty or partial</span></span>
<span><span class="co"># response from the API</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"page"</span>, <span class="va">n</span>, <span class="st">"after is"</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">after</span><span class="op">)</span>, <span class="st">"NULL"</span>, <span class="va">after</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">subsequent</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">query</span>, sort <span class="op">=</span> <span class="va">sort</span>, all_pages <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    fields <span class="op">=</span> <span class="va">fields</span>, size <span class="op">=</span> <span class="va">requested_rows</span>, after <span class="op">=</span> <span class="va">after</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># See if we got back an empty patents   </span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">subsequent</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">returned_rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">subsequent</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">returned_rows</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">count</span> <span class="op">&lt;-</span> <span class="va">count</span> <span class="op">+</span> <span class="va">returned_rows</span></span>
<span></span>
<span>  <span class="co"># We're done if we got an empty or partial reply from the API</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">returned_rows</span> <span class="op">&lt;</span> <span class="va">requested_rows</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="kw">break</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Now to page we need to set the "after" attribute to where the</span></span>
<span>  <span class="co"># current results ended.  Its value is the last/first</span></span>
<span>  <span class="co"># row's [[sort field]].  (It would need to be an array </span></span>
<span>  <span class="co"># of values if there are multiple sort fields)</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sort</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">sort</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"asc"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">subsequent</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">index</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">after</span> <span class="op">&lt;-</span> <span class="va">subsequent</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">s</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "page 1 after is NULL"</span></span>
<span><span class="co">#&gt; [1] "page 2 after is 1976-01-06"</span></span>
<span><span class="co">#&gt; [1] "page 3 after is 1976-01-13"</span></span>
<span><span class="co">#&gt; [1] "page 4 after is 1976-01-20"</span></span>
<span><span class="co">#&gt; [1] "page 5 after is 1976-01-27"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"count is"</span>, <span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "count is 4000"</span></span></code></pre></div>
<p>Here we ran into trouble since we chose patent_date as the sort field
which isn’t unique in our result set as patent_id is in Example 1. The R
package uses an appropriate primary key
(<code>get_ok_pk(endpoint)</code>) when requesting paged data
(<code>all_pages = TRUE</code>) from an endpoint. After all the pages
have been retrieved, the R package sorts the data as the user requested.
(This sorting methology lifted from the <a href="https://github.com/PatentsView/PatentsView-APIWrapper" class="external-link">Patentsview
python wrapper</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Baker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
