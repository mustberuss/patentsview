<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Citation networks • patentsview</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Citation networks">
<meta property="og:description" content="patentsview">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patentsview</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-flag"></span>
     
    API Changes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api-changes.html">
        <span class="fas fa-exclamation"></span>
         
        2022 API Changes
      </a>
    </li>
    <li>
      <a href="../articles/converting-an-existing-script.html">
        <span class="fas fa-sync"></span>
         
        Converting an Existing Script
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/getting-started.html">
    <span class="fas fa-play"></span>
     
    Getting started
  </a>
</li>
<li>
  <a href="../articles/writing-queries.html">
    <span class="fas fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li>
  <a href="../articles/examples.html">
    <span class="fas fa-code"></span>
     
    Examples
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-bar-chart"></span>
     
    Applications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/top-assignees.html">
        <span class="fas fa-university"></span>
         
        Top assignees
      </a>
    </li>
    <li>
      <a href="../articles/citation-networks.html">
        <span class="fas fa-long-arrow-left"></span>
         
        Citation networks
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fas fa-info-circle"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/patentsview">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="citation-networks_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Citation networks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/patentsview/blob/master/vignettes/citation-networks.Rmd"><code>vignettes/citation-networks.Rmd</code></a></small>
      <div class="hidden name"><code>citation-networks.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>Important API Change</p>
<p>The new version of the API requires an API key, or all of your
requests will be blocked. See the <a href="api-changes.html#an-api-key-is-required-1">API Changes</a>
page.</p>
</blockquote>
<p>The following is a brief foray into patent citation networks. The
analysis is done on 3 patents that describe patent citation analysis
(PCA) themselves.</p>
<p>The first step is to download the relevant data from the PatentsView
API. We can use the CPC code of <a href="https://worldwide.espacenet.com/classification#!/CPC=Y10S707/933">Y10S707/933</a>
to identify the patents that relate to PCA.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/patentsview/index.html">patentsview</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://datastorm-open.github.io/visNetwork/">visNetwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.name/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/webshot2">webshot2</a></span><span class="op">)</span>

<span class="co"># Write a query to pull patents assigned to the CPC code of "Y10S707/933"</span>

<span class="co"># ** the API currently throws a 500 error when searching by CPC codes</span>
<span class="co"># query &lt;- qry_funs$contains(cpc_current.cpc_subgroup_id = "Y10S707:933")</span>

<span class="co"># for now we'll pretend it worked</span>
<span class="va">pat_nums</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"10095778"</span>,<span class="st">"9075849"</span>,<span class="st">"8818996"</span>,<span class="st">"8504560"</span>,<span class="st">"8131701"</span>,<span class="st">"7966328"</span>,<span class="st">"7797336"</span>,<span class="st">"7716226"</span>,<span class="st">"7523126"</span>,<span class="st">"6499026"</span>,<span class="st">"6339767"</span><span class="op">)</span>

<span class="co"># we have to go against the patent_citiation endpoint now, these fields are no longer available from the patents endpoint</span>
<span class="co"># can we _or the two queries or does that blend the results? ie do we need a cited by query</span>
<span class="co"># and a separate citing query?</span>

<span class="co"># probably could do combined query and have two dplyrs to pull out citing and cited patents</span>
<span class="co"># one looking for patent_number in pat_nums and one looking for cited patent_number in pat_nums </span>
<span class="va">combined_query</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">or</span><span class="op">(</span>
   <span class="va">qry_funs</span><span class="op">$</span><span class="fu">eq</span><span class="op">(</span>patent_number <span class="op">=</span> <span class="va">pat_nums</span><span class="op">)</span>,
   <span class="va">qry_funs</span><span class="op">$</span><span class="fu">eq</span><span class="op">(</span>cited_patent_number <span class="op">=</span> <span class="va">pat_nums</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">citing_query</span> <span class="op">=</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">eq</span><span class="op">(</span>patent_number <span class="op">=</span> <span class="va">pat_nums</span><span class="op">)</span>
<span class="va">cited_query</span> <span class="op">=</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">eq</span><span class="op">(</span>cited_patent_number <span class="op">=</span> <span class="va">pat_nums</span><span class="op">)</span>

<span class="co"># mutate results here to mimic the return of the original version of the API??</span>
<span class="co"># or can we deal with the new structure directly?</span>

<span class="co"># old structure was</span>
<span class="co"># "patents": [ { "patent_number": "10095778","cited_patents": [{"cited_patent_number": "4991087",...}],</span>
<span class="co">#                                            "citedby_patents": [{"citedby_patent_number": "10635705"}],{...}]</span>

<span class="co"># new structure</span>
<span class="co"># "patent_citations": [ {"patent_number": "10095778", "cited_patent_number": "6430539"} ... ]</span>


<span class="co"># Create a list of fields to pull from the API</span>
<span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"patent_number"</span>, 
  <span class="st">"cited_patent_number"</span>
<span class="op">)</span>

<span class="co"># use a post?  the q: parameter is pretty big</span>
<span class="co"># Send a request to the API</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">citing_query</span>, fields <span class="op">=</span> <span class="va">fields</span>, all_pages <span class="op">=</span> <span class="cn">TRUE</span>, endpoint <span class="op">=</span> <span class="st">"patent_citations"</span>, method <span class="op">=</span> <span class="st">"GET"</span>, per_page <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">cited_query</span> , fields <span class="op">=</span> <span class="va">fields</span>, all_pages <span class="op">=</span> <span class="cn">TRUE</span>, endpoint <span class="op">=</span> <span class="st">"patent_citations"</span>, method <span class="op">=</span> <span class="st">"GET"</span>, per_page <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>

<span class="co"># Unnest the data found in the two lists of columns</span>
<span class="va">res_lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_pv_data.html">unnest_pv_data</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">data</span>, pk <span class="op">=</span> <span class="st">"patent_number"</span><span class="op">)</span>
<span class="va">res_lst</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ patent_citations:'data.frame':    1066 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ patent_number      : chr [1:1066] "10095778" ...</span>
<span class="co">#&gt;   ..$ cited_patent_number: chr [1:1066] "6430539" ...</span>

<span class="va">res_lst2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_pv_data.html">unnest_pv_data</a></span><span class="op">(</span><span class="va">res2</span><span class="op">$</span><span class="va">data</span>, pk <span class="op">=</span> <span class="st">"patent_number"</span><span class="op">)</span>
<span class="va">res_lst2</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ patent_citations:'data.frame':    851 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ patent_number      : chr [1:851] "10007946" ...</span>
<span class="co">#&gt;   ..$ cited_patent_number: chr [1:851] "7716226" ...</span></code></pre></div>
<div id="count-the-distinct-patent_number-and-cited_patent_number" class="section level1">
<h1 class="hasAnchor">
<a href="#count-the-distinct-patent_number-and-cited_patent_number" class="anchor"></a>count the distinct patent_number and cited_patent_number</h1>
<p>There are only 11 PCA patents. These patents cite 1066 patents and
are cited by 851 patents. Let’s visualize the citations among the PCA
patents. We’ll create our visualization using the
<code>visNetwork</code> package, which requires us to create a data
frame of nodes and a data frame of edges.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># with the API change we wouldn't have titles unless we call the patents endpoint</span>
<span class="co"># we'll use the patent number as the title for now</span>

<span class="va">pat_title</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">title</span>, <span class="va">number</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">temp_title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\n"</span>, <span class="st">"&lt;br&gt;"</span>, <span class="va">temp_title</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'&lt;a href="https://patents.google.com/patent/US'</span>, <span class="va">number</span>, <span class="st">'"&gt;'</span>, <span class="va">i</span>, <span class="st">'&lt;/a&gt;'</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">edges</span> <span class="op">&lt;-</span>
  <span class="va">res_lst</span><span class="op">$</span><span class="va">patent_citations</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html">semi_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">.</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cited_patent_number"</span> <span class="op">=</span> <span class="st">"patent_number"</span> <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">set_colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"from"</span>, <span class="st">"to"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># We could call the patents endpoint to get the patent titles but we'll just set</span>
<span class="co"># the title to the patent number</span>
<span class="va">nodes</span> <span class="op">&lt;-</span>
  <span class="va">res_lst</span><span class="op">$</span><span class="va">patent_citations</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
      id <span class="op">=</span> <span class="va">patent_number</span>,
      label <span class="op">=</span> <span class="va">patent_number</span>,
      title <span class="op">=</span> <span class="fu">pat_title</span><span class="op">(</span><span class="va">patent_number</span>, <span class="va">patent_number</span><span class="op">)</span>
    <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNetwork.html">visNetwork</a></span><span class="op">(</span>
  nodes <span class="op">=</span> <span class="va">nodes</span>, edges <span class="op">=</span> <span class="va">edges</span>, height <span class="op">=</span> <span class="st">"400px"</span>, width <span class="op">=</span> <span class="st">"100%"</span>,
  main <span class="op">=</span> <span class="st">"Citations among patent citation analysis (PCA) patents"</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visEdges.html">visEdges</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visIgraphLayout.html">visIgraphLayout</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-3-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
<p>It looks like several of the patents cite patent number 6,499,026,
perhaps indicating that this patent contains technology that is
foundational to the field. However, when we hover over the nodes we see
that several of the patents have the same title. Clicking on the titles
brings us to their full text on Google Patents, which confirms that many
of these PCA patents belong to the same patent family.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Let’s choose one of
the patents in each family to act as the family’s representative. This
will reduce the size of the subsequent network, while hopefully
retaining its overall structure.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"7797336"</span>, <span class="st">"9075849"</span>, <span class="st">"6499026"</span><span class="op">)</span>
<span class="va">res_lst2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">res_lst</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">patent_number</span> <span class="op">%in%</span> <span class="va">p3</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
<p>With only 3 patents, it will probably be possible to visualize how
these patents’ cited and citing patents are all related to one another.
Let’s create a list of these “relevant patents” (i.e., the 3 patents
plus all of their cited and citing patents)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>, and then get a list
of all of their cited patents (i.e., the patents that they cite). This
list of cited patents will allow us to measure how similar the relevant
patents are to one another.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rel_pats</span> <span class="op">&lt;-</span>
  <span class="va">res_lst</span><span class="op">$</span><span class="va">patent_citations</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">res_lst</span><span class="op">$</span><span class="va">patent_citations</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>patent_number <span class="op">=</span> <span class="va">cited_patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>patent_number <span class="op">=</span> <span class="va">p3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">patent_number</span><span class="op">)</span><span class="op">)</span>

<span class="co"># difference here from the original API's output</span>
<span class="co"># then: Rows: 537 Columns: 1 $ patent_number</span>
<span class="co">#  now: Rows: 269 Columns: 1 $ patent_number </span>

<span class="co"># Look up which patents the relevant patents cite</span>
<span class="co"># we use the patent_citation endpoint now, we can't get patent_title here</span>

<span class="va">rel_pats_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span>
  query <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>patent_number <span class="op">=</span> <span class="va">rel_pats</span><span class="op">$</span><span class="va">patent_number</span><span class="op">)</span>,
  fields <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cited_patent_number"</span>, <span class="st">"patent_number"</span><span class="op">)</span>, 
  all_pages <span class="op">=</span> <span class="cn">TRUE</span>, per_page <span class="op">=</span> <span class="fl">1000</span>, method <span class="op">=</span> <span class="st">"POST"</span>, endpoint <span class="op">=</span> <span class="st">"patent_citations"</span>
<span class="op">)</span>

<span class="va">rel_pats_lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_pv_data.html">unnest_pv_data</a></span><span class="op">(</span><span class="va">rel_pats_res</span><span class="op">$</span><span class="va">data</span>, <span class="st">"patent_number"</span><span class="op">)</span>

<span class="co"># another difference here</span>
<span class="co"># old data.frame':  537 obs. of  2 variables</span>
<span class="co"># new 'data.frame': 4855 obs. of  2 variables</span></code></pre></div>
<p>Now we know which patents the 4855 relevant patents cite. This allows
us to measure the similarity between the 4855 patents by seeing how many
cited references they share in common (a method known as <a href="https://en.wikipedia.org/wiki/Bibliographic_coupling">bibliographic
coupling</a>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cited_pats</span> <span class="op">&lt;-</span>
  <span class="va">rel_pats_lst</span><span class="op">$</span><span class="va">patent_citations</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">cited_patent_number</span><span class="op">)</span><span class="op">)</span>

<span class="co"># difference here too</span>
<span class="co"># old Rows: 51,266</span>
<span class="co"># new Rows:  4,855</span>

<span class="va">full_network</span> <span class="op">&lt;-</span> 
  <span class="va">cited_pats</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span><span class="op">(</span><span class="op">{</span>
      <span class="va">.</span><span class="op">$</span><span class="va">ind</span> <span class="op">&lt;-</span> 
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span> 
          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_data.html">group_indices</a></span><span class="op">(</span><span class="op">)</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span>  
          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sqrt_num_cited <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, y <span class="op">=</span> <span class="va">.</span>, by <span class="op">=</span> <span class="st">"cited_patent_number"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">ind.x</span> <span class="op">&gt;</span> <span class="va">ind.y</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">patent_number.x</span>, <span class="va">patent_number.y</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cosine_sim <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">sqrt_num_cited.x</span> <span class="op">*</span> <span class="va">sqrt_num_cited.y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"patent_number\\.|cosine_sim"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">full_network</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">patent_number.x</th>
<th align="left">patent_number.y</th>
<th align="right">cosine_sim</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">5950214</td>
<td align="left">5848409</td>
<td align="right">0.9710145</td>
</tr>
<tr class="even">
<td align="left">5761497</td>
<td align="left">5692176</td>
<td align="right">0.8902638</td>
</tr>
<tr class="odd">
<td align="left">5761497</td>
<td align="left">5404295</td>
<td align="right">0.1400280</td>
</tr>
<tr class="even">
<td align="left">5761497</td>
<td align="left">5623679</td>
<td align="right">0.0278207</td>
</tr>
<tr class="odd">
<td align="left">5761497</td>
<td align="left">5696963</td>
<td align="right">0.0505722</td>
</tr>
<tr class="even">
<td align="left">5761497</td>
<td align="left">5623681</td>
<td align="right">0.0278207</td>
</tr>
</tbody>
</table>
<p><code>full_network</code> contains the similarity score
(<code>cosine_sim</code>) for all patent pairs that share at least one
cited reference in common. This means that it probably contains a lot of
patent pairs that have only one or two cited references in common, and
thus aren’t all that similar. Let’s try to identify a natural level of
<code>cosine_sim</code> to filter on so that our subsequent network is
not too hairy.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span>
  <span class="va">full_network</span><span class="op">$</span><span class="va">cosine_sim</span>, 
  main <span class="op">=</span> <span class="st">"Similarity scores between patents relevant to PCA"</span>,
  xlab <span class="op">=</span> <span class="st">"Cosine similarity"</span>, ylab <span class="op">=</span> <span class="st">"Number of patent pairs"</span>
<span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-7-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-7</p>
</div>
<p>There appears to be a smallish group of patent pairs that are very
similar to one another (<code>cosine_sim</code> &gt; 0.8), which makes
it tempting to choose 0.8 as a cutoff point. However, patent pairs that
have reference lists that are this similar to each other are probably
just patents in the same patent family. Let’s choose 0.1 as a cutoff
point instead, as there doesn’t appear to be too many pairs above this
point.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">edges</span> <span class="op">&lt;-</span> 
  <span class="va">full_network</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cosine_sim</span> <span class="op">&gt;=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">patent_number.x</span>, to <span class="op">=</span> <span class="va">patent_number.y</span>, value <span class="op">=</span> <span class="va">cosine_sim</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Cosine similarity ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">nodes</span> <span class="op">&lt;-</span>
  <span class="va">rel_pats_lst</span><span class="op">$</span><span class="va">patent_citations</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">patent_number</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>
      <span class="co"># the 3 patents of interest will be represented as blue nodes, all others</span>
      <span class="co"># will be yellow</span>
      color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">id</span> <span class="op">%in%</span> <span class="va">p3</span>, <span class="st">"#97C2FC"</span>, <span class="st">"#DDCC77"</span><span class="op">)</span>, 
      label <span class="op">=</span> <span class="va">id</span>,
      title <span class="op">=</span> <span class="fu">pat_title</span><span class="op">(</span><span class="va">id</span>, <span class="va">id</span><span class="op">)</span>  <span class="co"># we don't get patent_title now (formerly first argument)</span>
    <span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visNetwork.html">visNetwork</a></span><span class="op">(</span>
  nodes <span class="op">=</span> <span class="va">nodes</span>, edges <span class="op">=</span> <span class="va">edges</span>, height <span class="op">=</span> <span class="st">"700px"</span>, width <span class="op">=</span> <span class="st">"100%"</span>,
  main <span class="op">=</span> <span class="st">"Network of patents relevant to PCA"</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visEdges.html">visEdges</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#343434"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visOptions.html">visOptions</a></span><span class="op">(</span>highlightNearest <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">TRUE</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/visNetwork/man/visIgraphLayout.html">visIgraphLayout</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-8-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-8</p>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>A patent family is a group of related patents, usually
all authored by the same inventor and relating to the same technology.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Defining the network of patents relevant to PCA as those
that cite or are cited by the 3 patents of interest is fairly
restrictive (i.e., it doesn’t adequately capture all of the patents
related to PCA). There are likely patents out there that aren’t cited by
nor cite any of the 3, but are still relevant to PCA. One would need to
measure the similarity between all the patents that are in the general
area of PCA to get a more complete picture of the patents in this area.
This is a much harder problem, though, and would require more analysis
than can fit in a single vignette.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>This is still a pretty arbitrary choice. Take a look at
algorithms like the <a href="http://www.pnas.org/content/106/16/6483.full.pdf">disparity
filter</a> for a more systematic way to filter edges.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Baker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
