<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Converting an Existing Script • patentsview</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Converting an Existing Script">
<meta property="og:description" content="patentsview">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patentsview</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">
    <span class="fa fa-play"></span>
     
    Getting started
  </a>
</li>
<li>
  <a href="../articles/writing-queries.html">
    <span class="fa fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li>
  <a href="../articles/examples.html">
    <span class="fa fa-code"></span>
     
    Examples
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-bar-chart"></span>
     
    Applications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/top-assignees.html">
        <span class="fa fa-university"></span>
         
        Top assignees
      </a>
    </li>
    <li>
      <a href="../articles/citation-networks.html">
        <span class="fa fa-long-arrow-left"></span>
         
        Citation networks
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fa fa-info-circle"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/patentsview" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Converting an Existing Script</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/patentsview/blob/HEAD/vignettes/converting-an-existing-script.Rmd" class="external-link"><code>vignettes/converting-an-existing-script.Rmd</code></a></small>
      <div class="hidden name"><code>converting-an-existing-script.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="necessary-script-changes">Necessary Script Changes<a class="anchor" aria-label="anchor" href="#necessary-script-changes"></a>
</h2>
<p>If you have a script that worked with the original R package and
original version of the API, chances are it will need some possibly
substantial changes before it will work with the new version of the R
package and API.</p>
</div>
<div class="section level2">
<h2 id="the-one-required-change">The One Required Change<a class="anchor" aria-label="anchor" href="#the-one-required-change"></a>
</h2>
<p>First off you’ll need to <a href="https://patentsview.org/apis/keyrequest" class="external-link">request an API key</a>
and then set the environmental variable PATENTSVIEW_API_KEY to the value
of your API key. Ex. set PATENTSVIEW_API_KEY=My_api_key Without a valid
API key, all your calls will be rejected by the API. There would be a
small chance that that is all that is needed to convert a simple script
to use the new R package and new version of the API.</p>
</div>
<div class="section level2">
<h2 id="the-new-throttling-limit">The New Throttling Limit<a class="anchor" aria-label="anchor" href="#the-new-throttling-limit"></a>
</h2>
<p>Another new thing is a throttling limit. The new version of the API
only allows an individual API key to make 45 calls per minute. The call
that exceeds that limit is rejected but does return the number of
seconds to wait before calls would be allowed again. Fortunately, the R
package handles this for you! Your script will be chugging along and if
the API should return a throttling response, the R package will sleep
for the required number of seconds before automatically resending your
query! The only thing you may notice, besides a warning message, it that
the script will pause when throttled before it picks right back up
again.</p>
<p>The new versions of the API’s endpoints are less Swiss Army
Knife-like than before, where you could get nearly any data field from
any endpoint. Now they have substantially lighter responses and they
generally focus on data pertinent to that endpoint. In other words, you
can only get uspc fields from the uspc endpoints. This may mean you’ll
have to make multiple calls to different endpoints to get the same data
the old version of API used to return in a single call.</p>
<p>Take a look at the top <a href="../top-assignees.html">assignees
application</a>. It has to blend together information from separate
calls that used to be returned by a single call. This may push your
dplyr knowlegde to the limit.</p>
</div>
<div class="section level2">
<h2 id="changed-field-names-and-types">Changed Field Names and Types<a class="anchor" aria-label="anchor" href="#changed-field-names-and-types"></a>
</h2>
<p>The fields selected in the original stript not be available from the
new version’s endpoints. Fields like the government interests are no
longer available (see <a href="https://patentsview.org/data-in-action/whats-new-patentsview-july-2021" class="external-link uri">https://patentsview.org/data-in-action/whats-new-patentsview-july-2021</a>).
Also, some attributes have new names, like name_last in the nested
inventor object. Now in the fields parameter it would be specified as
“inventor.name_last” where formerly it was “inventor_last_name” when
using the patents endpoint.</p>
<p>Also note that some field’s types have changed, meaning you’ll need
to use different operators within your query. Ex. assignee.organization
is now a full text field, formerly it was a string.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mustberuss.github.io/patentsview/index.html" class="external-link">patentsview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Before you could do a </span></span>
<span><span class="va">qry_funs</span><span class="op">$</span><span class="fu">contains</span><span class="op">(</span>assignee_organization<span class="op">=</span><span class="st">"Rice University"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"_contains":{"assignee_organization":"Rice University"}}</span></span>
<span></span>
<span><span class="co"># now you would have to do </span></span>
<span><span class="va">qry_funs</span><span class="op">$</span><span class="fu">text_phrase</span><span class="op">(</span>assignees.assignee_organization<span class="op">=</span><span class="st">"Rice University"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"_text_phrase":{"assignees.assignee_organization":"Rice University"}}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additions-to-the-r-package">Additions to the R Package<a class="anchor" aria-label="anchor" href="#additions-to-the-r-package"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># There is a new in_range query function</span></span>
<span></span>
<span><span class="va">range</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">in_range</span><span class="op">(</span>patent_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1970-01-01"</span>,<span class="st">"1983-02-28"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># which will generate this, so you don't have to do it by hand</span></span>
<span><span class="va">range</span></span>
<span><span class="co">#&gt; {"_and":[{"_gte":{"patent_date":"1970-01-01"}},{"_lte":{"patent_date":"1983-02-28"}}]}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>So there you have it, our attempt at listing what’s changed and what
to do about it. <a href="https://patentsview.org/apis/keyrequest" class="external-link">Request</a> an API key
and get going with the new version of the R package! The two API
versions will coexist for a while but API team plans to shutdown the
original version of the API at the end of 2022.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Christopher Baker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
