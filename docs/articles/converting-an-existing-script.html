<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="patentsview">
<title>Converting an Existing Script • patentsview</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Converting an Existing Script">
<meta property="og:description" content="patentsview">
<meta property="og:image" content="https://mustberuss.github.io/patentsview/index.html/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">patentsview</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--api-changes">
    <span class="fa fa-flag"></span>
     
    API Changes
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--api-changes">
    <a class="dropdown-item" href="../articles/api-changes.html">
      <span class="fa fa-exclamation"></span>
       
      2024 API Changes
    </a>
    <a class="dropdown-item" href="../articles/converting-an-existing-script.html">
      <span class="fa fa-sync"></span>
       
      Converting an Existing Script
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started.html">
    <span class="fa fa-play"></span>
     
    Getting started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/writing-queries.html">
    <span class="fa fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--applications">
    <span class="fa fa-bar-chart"></span>
     
    Applications
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--applications">
    <a class="dropdown-item" href="../articles/examples.html">
      <span class="fa fa-code"></span>
       
      Examples
    </a>
    <a class="dropdown-item" href="../articles/top-assignees.html">
      <span class="fa fa-university"></span>
       
      Top assignees
    </a>
    <a class="dropdown-item" href="../articles/citation-networks.html">
      <span class="fa fa-long-arrow-left"></span>
       
      Citation networks
    </a>
    <a class="dropdown-item" href="../articles/ropensci_blog_post.html">
      <span class="fa fa-bullhorn"></span>
       
      ropensci announcement
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/patentsview/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Converting an Existing Script</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/patentsview/blob/HEAD/vignettes/converting-an-existing-script.Rmd" class="external-link"><code>vignettes/converting-an-existing-script.Rmd</code></a></small>
      <div class="d-none name"><code>converting-an-existing-script.Rmd</code></div>
    </div>

    
    
<p>If you have a script that worked with the original R package and
original version of the API, chances are it will need some possibly
substantial changes before it will work with the new version of the R
package and API.</p>
<div class="section level2">
<h2 id="required-api-key">Required API Key<a class="anchor" aria-label="anchor" href="#required-api-key"></a>
</h2>
<p>First off you’ll need to <a href="https://patentsview.org/apis/keyrequest" class="external-link">request an API key</a>
and then set the environmental variable PATENTSVIEW_API_KEY to the value
of your API key. Ex. set PATENTSVIEW_API_KEY=My_api_key Without a valid
API key, all your calls will be rejected by the API. ## The New
Throttling Limit Another new thing is a throttling limit. The new
version of the API only allows an individual API key to make 45 calls
per minute. The call that exceeds that limit is rejected but does return
the number of seconds to wait before calls would be allowed again.
Fortunately, the R package handles this for you! Your script will be
chugging along and if the API should return a throttling response, the R
package will sleep for the required number of seconds before
automatically resending your query! The only thing you may notice,
besides a warning message, it that the script will pause when throttled
before it picks right back up again.</p>
</div>
<div class="section level2">
<h2 id="philosophical-change">Philosophical Change<a class="anchor" aria-label="anchor" href="#philosophical-change"></a>
</h2>
<p>The new version of the API’s endpoints are less Swiss Army Knife-like
than before, where you could get nearly any data field from any
endpoint. Now they have substantially lighter responses and they
generally focus on data pertinent to that endpoint. In other words, you
can only get USPC fields from the USPC endpoints or from the patent
endpoint. This may mean you’ll have to make multiple calls to different
endpoints to get the same data the old version of API used to return in
a single call.</p>
<p>Take a look at the <a href="top-assignees.html">top assignees
application</a>. It has to blend together information from separate
calls that used to be returned by a single call. This may push your
dplyr skills to the limit.</p>
</div>
<div class="section level2">
<h2 id="changed-field-names-and-types">Changed Field Names and Types<a class="anchor" aria-label="anchor" href="#changed-field-names-and-types"></a>
</h2>
<p>The fields requested by the original script or used in its query may
not be available from the new version’s endpoints. The nber attributes
are no longer available as the nber_subcategories endpoint was removed.
Also, some attributes have new names, like name_last in the nested
inventor object returned by the patent endpoint. Now in the fields
parameter it would be specified as “inventor.name_last” where formerly
it was “inventor_last_name” when using the patent endpoint. This also
demonstrates how nested fields need to be fully qualified in the query
or fields parameters.</p>
<p>Also note that some field’s types have changed, meaning you’ll need
to use different operators within your query. Ex. assignee.organization
is now a full text field, formerly it was a string.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mustberuss.github.io/patentsview/index.html">patentsview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Before you could do a </span></span>
<span><span class="va">qry_funs</span><span class="op">$</span><span class="fu">contains</span><span class="op">(</span>assignee_organization<span class="op">=</span><span class="st">"Rice University"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"_contains":{"assignee_organization":"Rice University"}}</span></span>
<span></span>
<span><span class="co"># now you would have to do </span></span>
<span><span class="va">qry_funs</span><span class="op">$</span><span class="fu">text_phrase</span><span class="op">(</span>assignees.assignee_organization<span class="op">=</span><span class="st">"Rice University"</span><span class="op">)</span></span>
<span><span class="co">#&gt; {"_text_phrase":{"assignees.assignee_organization":"Rice University"}}</span></span></code></pre></div>
<p>Checkout the <a href="https://search.patentsview.org/docs/docs/Search%20API/SearchAPIReference/#endpoints" class="external-link">API
documentation</a> and the <a href="https://search.patentsview.org/swagger-ui/" class="external-link">Swagger UI page</a> to
see the returned fields and their types. The same information is
available in the <code>fieldsdf</code> data frame but it is harder to
read.</p>
</div>
<div class="section level2">
<h2 id="singular-endpoints">Singular Endpoints<a class="anchor" aria-label="anchor" href="#singular-endpoints"></a>
</h2>
<p>The endpoints are now singular, ex: patent where previously it was
patents.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_endpoints.html">get_endpoints</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "assignee"                       "brf_sum_text"                  </span></span>
<span><span class="co">#&gt;  [3] "claim"                          "cpc_class"                     </span></span>
<span><span class="co">#&gt;  [5] "cpc_group"                      "cpc_subclass"                  </span></span>
<span><span class="co">#&gt;  [7] "detail_desc_text"               "draw_desc_text"                </span></span>
<span><span class="co">#&gt;  [9] "inventor"                       "ipc"                           </span></span>
<span><span class="co">#&gt; [11] "location"                       "patent"                        </span></span>
<span><span class="co">#&gt; [13] "patent/attorney"                "patent/foreign_citation"       </span></span>
<span><span class="co">#&gt; [15] "patent/rel_app_text"            "patent/us_application_citation"</span></span>
<span><span class="co">#&gt; [17] "patent/us_patent_citation"      "publication"                   </span></span>
<span><span class="co">#&gt; [19] "publication/rel_app_text"       "uspc_mainclass"                </span></span>
<span><span class="co">#&gt; [21] "uspc_subclass"                  "wipo"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additions-to-the-r-package">Additions to the R Package<a class="anchor" aria-label="anchor" href="#additions-to-the-r-package"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># There is a new in_range query function</span></span>
<span></span>
<span><span class="va">range_query</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">in_range</span><span class="op">(</span>patent_date<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1970-01-01"</span>,<span class="st">"1983-02-28"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># which will generate this, so you don't have to do it by hand</span></span>
<span><span class="va">range_query</span></span>
<span><span class="co">#&gt; {"_and":[{"_gte":{"patent_date":"1970-01-01"}},{"_lte":{"patent_date":"1983-02-28"}}]}</span></span>
<span></span>
<span><span class="va">range_query</span> <span class="op">&lt;-</span> <span class="va">qry_funs</span><span class="op">$</span><span class="fu">in_range</span><span class="op">(</span>patent_year<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>, <span class="fl">2021</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">range_query</span></span>
<span><span class="co">#&gt; {"_and":[{"_gte":{"patent_year":2010}},{"_lte":{"patent_year":2021}}]}</span></span></code></pre></div>
<p>Some of the endpoints now return HATEOAS links, where you make a call
back to the API to retrieve additional data. The new method
retrieve_linked_data() does just that.<br>
There is a lot more about this <a href="api-changes.html#hateoas-links">here</a>.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>So there you have it, our attempt at listing what’s changed and what
to do about it. <a href="https://patentsview.org/apis/keyrequest" class="external-link">Request</a> an API key
and get going with the new version of the R package! The two API
versions will coexist for a while but the API team plans to shutdown the
original version of the API in February 2025.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Baker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
