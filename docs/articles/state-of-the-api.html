<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="patentsview">
<title>State of the API • patentsview</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="State of the API">
<meta property="og:description" content="patentsview">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">patentsview</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--api-changes">
    <span class="fa fa-flag"></span>
     
    API Changes
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--api-changes">
    <a class="dropdown-item" href="../articles/api-changes.html">
      <span class="fa fa-exclamation"></span>
       
      2025 API Changes
    </a>
    <a class="dropdown-item" href="../articles/converting-an-existing-script.html">
      <span class="fa fa-sync"></span>
       
      Converting an Existing Script
    </a>
    <a class="dropdown-item" href="../articles/result-set-paging.html">
      <span class="fa fa-book"></span>
       
      Result Set Paging
    </a>
    <a class="dropdown-item" href="../articles/understanding-the-api.html">
      <span class="fa fa-school"></span>
       
      Understanding the API
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started.html">
    <span class="fa fa-play"></span>
     
    Getting started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/writing-queries.html">
    <span class="fa fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--applications">
    <span class="fa fa-bar-chart"></span>
     
    Applications
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--applications">
    <a class="dropdown-item" href="../articles/examples.html">
      <span class="fa fa-code"></span>
       
      Examples
    </a>
    <a class="dropdown-item" href="../articles/top-assignees.html">
      <span class="fa fa-university"></span>
       
      Top assignees
    </a>
    <a class="dropdown-item" href="../articles/citation-networks.html">
      <span class="fa fa-long-arrow-left"></span>
       
      Citation networks
    </a>
    <a class="dropdown-item" href="../articles/ropensci-blog-post.html">
      <span class="fa fa-bullhorn"></span>
       
      ropensci announcement
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/patentsview/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>State of the API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/patentsview/blob/HEAD/vignettes/articles/state-of-the-api.Rmd" class="external-link"><code>vignettes/articles/state-of-the-api.Rmd</code></a></small>
      <div class="d-none name"><code>state-of-the-api.Rmd</code></div>
    </div>

    
    
<p>There’s a lot going on with the new version of the Patentsview API,
recently renamed PatentSearch API, as announced <a href="https://search.patentsview.org/docs/#naming-update" class="external-link">here</a>.</p>
<div class="section level2">
<h2 id="release">2024-02-14 Release<a class="anchor" aria-label="anchor" href="#release"></a>
</h2>
<p>The newest release brough new bugs</p>
<ol style="list-style-type: decimal">
<li><p>These TEST_QUERIES now return zero rows: “cpc_subclass”,
“uspc_mainclass”, “uspc_subclass”, “wipo”<br>
this one throws a 500 “ipc” See test_that(“Some test queries don’t
work”) in test-api-bugs.</p></li>
<li><p>get_fields(“cpc_subclass”) returns both “cpc_class” and
“cpc_class_id” but “cpc_class” fails their validation (the request
throws a 400 Invalid field: cpc_subclass)</p></li>
<li><p>The publication endpoint’s rule_47_flag is now a boolean but all
values seem to be FALSE. See test-api-bugs’ “Querying the publication
endpoint on rule_47_flag isn’t meaningful”</p></li>
<li>
<p>We still cannot request or query by inventors.inventor or
assignees.assignee. With a hack in fieldsdf we can request
inventors.inventor_id and assignees.assignee_id to receive inventor_id,
assignee_id and the two HATEOAS links, inventor” and assignee. Without
the hack test-search-pv’s “Shorthand specification of fields results in
expected results” returns fewer fields than requested on the second
call.</p>
<p>More importantly, searching by invenor or inventor_id is not possible
without the hack. See the request just above <a href="understanding-the-api.html#acknowledgment">Acknowledgment</a>
which also shows the unrequested HATEOAS (_id-less) field being selected
away.</p>
</li>
</ol>
</div>
<div class="section level2">
<h2 id="questions">Questions<a class="anchor" aria-label="anchor" href="#questions"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Should we expose the <a href="https://search.patentsview.org/docs/docs/Search%20API/SearchAPIReference/#options-o" class="external-link">two
new options</a> “pad_patent_id” and “exclude_withdrawn”? If so, we would
need to add back pad_patent_id() and making it an error if pad_patent_id
is TRUE when all_pages is TRUE (or we’d have to pad while paging).</li>
</ol>
<p>The padding after alphas version of pad_patent_id() would need to be
used<br>
Request padded patent_id’s</p>
<pre><code>curl -X 'POST' \
  'https://search.patentsview.org/api/v1/patent/' \
  -H 'accept: application/json' \
  -H "X-Api-Key: $PATENTSVIEW_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{"q":{"patent_date":"2007-03-06"},"f":["patent_id"],"s":[{"patent_id":"desc"}],
"o":{"size":10, "pad_patent_id": true}}'</code></pre>
<p>Same with “after”</p>
<pre><code>curl -X 'POST' \
  'https://search.patentsview.org/api/v1/patent/' \
  -H 'accept: application/json' \
  -H "X-Api-Key: $PATENTSVIEW_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{"q":{"patent_date":"2007-03-06"},"f":["patent_id"],"s":[{"patent_id":"desc"}],
"o":{"size":10, "pad_patent_id": true, "after":"PP017481"}}'</code></pre>
<p>For completeness, not sure why someone would want withdrawn
patents.<br>
patent_ids from test_that(“Withdrawn patents are suppressed by default
but some are present in the database”)</p>
<pre><code>curl -X 'POST' \
  'https://search.patentsview.org/api/v1/patent/' \
  -H 'accept: application/json' \
  -H "X-Api-Key: $PATENTSVIEW_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{"q":{"patent_id":["9978309", "9978406", "9978509", "9978615", "9978659"]},
 "f":["patent_id"],"s":[{"patent_id":"asc"}],
"o":{"size":10, "exclude_withdrawn": false}}'
</code></pre>
<p>Note that the API returns no rows if you also specify
<code>"pad_patent_id": true</code> (since the patent_ids in q: aren’t
padded)</p>
</div>
<div class="section level2">
<h2 id="on-the-plus-side">On the Plus Side<a class="anchor" aria-label="anchor" href="#on-the-plus-side"></a>
</h2>
<p>Here are the positive API changes:</p>
<ul>
<li><p>All fields can be queried now.</p></li>
<li><p>The 100,000 row result set size limit seems to be gone. Might be
part curse as a user might not have intended to <a href="api-changes.html#unbounded">retrieve all utility patents</a>
etc.</p></li>
<li>
<p>The new version of the API returns data in types other than
strings, e.g. application.rule_47_flag from the patent endpoint is a
boolean.
<code>View(fieldsdf[grep('number|integer|boolean',fieldsdf$data_type),c("endpoint","field","data_type")])</code>
currently returns 90 rows</p>
<p>There are still a few fields where the API returns strings that
<code>cast-pv-data()</code> casts to a more appropriate data type<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Observation sent to the API team.&lt;/p&gt;"><sup>1</sup></a>.
fieldsdf$data_type is set to int or bool for these fields.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/patentsview/index.html">patentsview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Count of non string, non date fields returned by the new version of the API</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fieldsdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"number|integer|boolean"</span>, <span class="va">fieldsdf</span><span class="op">$</span><span class="va">data_type</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 86</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fieldsdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bool$|int$"</span>, <span class="va">fieldsdf</span><span class="op">$</span><span class="va">data_type</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"endpoint"</span>, <span class="st">"field"</span>, <span class="st">"data_type"</span><span class="op">)</span><span class="op">]</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] endpoint  field     data_type</span></span>
<span><span class="co">## &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre>
</li>
<li><p>The API team created a <a href="patentsview-breaking-release.html#online-documentation">Swagger
UI</a> page for the new version of the API. It has a nice feature where
it will show you what the Request URL was for a GET request. The Request
URL can be passed to <code>retrieve_linked_data</code> to see its output
from the R package, as explained below. On a POST request, it will show
you the Curl command that will make the same request to the API. It can
be helpful to see the exact return from the API, making it possible to
tell if the results weren’t what you expected or if the R package is
somehow misinterpreting them. On other <a href="https://patentsview.historicip.com/swagger/articles/" class="external-link">Joys of
Swagger UI</a></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="issues">Issues<a class="anchor" aria-label="anchor" href="#issues"></a>
</h2>
<ul>
<li><p>The 2024-11-06 API release seems to have intentionally changed
paging by patent_id, details <a href="#paging-change">below</a></p></li>
<li><p>The original API’s sunset date is currently February 12, 2025
though the new version still has <a href="api-changes.html#things-to-note">issues</a></p></li>
<li><p>On a new <a href="api-changes.html#case-sensitivity-caveat">string case
sensitivity</a>, opened as a <a href="#case-dependent">bug</a> listed
below</p></li>
<li><p>On <a href="api-changes.html#string-and-full-text-operators">string vs full
text operators</a>, also opened as a bug listed below. Note that there
isn’t a way to distinguish strings and full text fields in the OpenAPI
object (limitation of the OpenAPI spec). We may need to change the way
fieldsdf is generated if we need to track what operators can be used,
possibly parsing the <a href="https://search.patentsview.org/docs/docs/Search%20API/SearchAPIReference/#endpoints" class="external-link">API’s
endpoints page</a></p></li>
<li>
<p>On needing to centralize information, there are fairly important
things scattered across multiple pages:</p>
<ol style="list-style-type: decimal">
<li>
<p>On <a href="https://patentsview.org/classification" class="external-link uri">https://patentsview.org/classification</a> there’s this
about the wipo endpoint’s data that I don’t think can be found anywhere
else:</p>
<table class="table">
<colgroup>
<col width="36%">
<col width="31%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>PATENT CLASSIFICATION</th>
<th>PATENT GRANT YEARS AVAILABLE</th>
<th>ADDITIONAL INFORMATION</th>
</tr></thead>
<tbody><tr class="odd">
<td>WIPO</td>
<td>1976–2020</td>
<td>Limited to the top three WIPO categories</td>
</tr></tbody>
</table>
</li>
<li><p>There is a similar <a href="api-changes.html#text_endpoints">data
cavaet</a> about the Patent Text and Publication Text endpoints which
may not be updated any longer.</p></li>
<li><p>Similarily, a field shorthand notation and a little non-obvious
behavior is only mentioned in the API team’s jupyter notebook as
mentioned <a href="#new-vignette">below</a>.</p></li>
</ol>
</li>
<li>
<p>API Oddities</p>
<ul>
<li><p>Some <a href="api-changes.html#slight-weirdness">requested
fields</a> ending with _id come back without the _id<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Observation sent to the API team but they might not see
it as a bug.&lt;/p&gt;"><sup>2</sup></a> Ex patent endpoint
requested inventors.inventor_id and assignees.assignee_id are returned
as inventors.inventor and assignees.assignee, their values are their
respective HATEOAS links</p></li>
<li>
<p>Two of the <a href="api-changes.html#hateoas-links">HATEOAS
links</a> use a colon instead of having two URL parameters</p>
<ul>
<li>https<a href=""></a>://search.patentsview.org/api/v1/cpc_group/G01S7:4865/</li>
<li>https<a href=""></a>://search.patentsview.org/api/v1/uspc_subclass/403:57/
(endpoint currently throws a 500)</li>
</ul>
<p>An <a href="api-changes.html#an-api-key-is-required">API key</a> is
now required so, intentionally, these URLs aren’t clickable since no API
key would be sent, resulting in a 403 Forbidden response.</p>
</li>
<li>
<p>Field inconsistencies</p>
<ul>
<li><p>There are two rule_47_flag fields, one returned by the patent
endpoint and one returned by the publication endpoint. The former is
returned as a boolean, the latter as a string that cast-pv-data casts to
a boolean.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Observation sent to the API team.&lt;/p&gt;"><sup>3</sup></a></p></li>
<li><p>assignee_type, available from three endpoints, is returned as a
string but looks like they’re integer values<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;There isn’t a data dictionary for the API so I suggested
they create one.&lt;/p&gt;"><sup>4</sup></a></p></li>
<li><p>Most document_number fields are integers but there are two that
are returned as strings that cast-pv-data casts to integers.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Observation sent to the API team.&lt;/p&gt;"><sup>5</sup></a> <a href="getting-started.html#casting-fields">Additional
details</a></p></li>
<li><p>g_claim returns <code>exemplary</code> with values of either “0”
or “1”. Not sure if they should be cast as logicals.</p></li>
</ul>
</li>
<li>
<p>Most endpoints’ returns are the plural form of the singular
endpoint with these two exceptions:</p>
<table class="table">
<thead><tr class="header">
<th>endpoint</th>
<th>returned entity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>ipc</td>
<td>ipcr</td>
</tr>
<tr class="even">
<td>wipo</td>
<td>wipo</td>
</tr>
</tbody>
</table>
</li>
<li><p>Two endpoints, publication/rel_app_text and patent/rel_app_text
both return an<br>
entity named rel_app_texts though their fields are different. (The
former contains document_number and the later contains patent_id. In
both the only other field is related_text.)</p></li>
<li>
<p>Not exactly an oddity, but with no better place for this, here’s
a comparison of the old and new attributes that can be sent to the API
in its o: (options) parameter via <code><a href="../reference/search_pv.html">search_pv()</a></code></p>
<table class="table">
<colgroup>
<col width="38%">
<col width="35%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th>Original API</th>
<th>New Version</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>per_page (max 10,000)</td>
<td>size (max 1,000)</td>
<td>maximum number of rows to return on each request</td>
</tr>
<tr class="even">
<td>page</td>
<td>after</td>
<td>page through large result sets</td>
</tr>
<tr class="odd">
<td>subent_cnts</td>
<td></td>
<td>whether the query results should include the total counts of unique
subentities</td>
</tr>
<tr class="even">
<td>mtchd_subent_only</td>
<td></td>
<td>whether a query should return all related subentities or just those
that match query criteria.</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>As another not-exactly-an-oddity, the API’s sort on patent_id, a
string field, gets funky when mixing patent ids above and below
10,000,000 (the ones 10M and above come first). The same thing happens
with other patent types, like reissue, when the ids have different
string lengths. See the code block at the bottom of the <a href="understanding-the-api.html#unexpected-results">understanding the
api</a> vignette.</p>
<p><em>Update</em>: the API now sorts as you’d expect but at a fairly
high price. Now if you do your own paging using patent_id, you have to
zero pad the after parameter to 8 characters. Surprizingly, the padded
values are never visible in the returned data. See <a href="#paging-change">below</a></p>
</li>
<li><p>Along the same lines, this query currently returns 2,084,459 rows
when that isn’t at all what I expected! (I checked and the original
version of the API did this too.)
<code>{"_and":[{"_gte":{"patent_id":"10"}},{"_lte":{"patent_id":"13"}}]}</code></p></li>
<li>
<p>These oddities are not specific to the new version of the API,
but are due to the source files that make up the patentsview database. I
opened these issues as API bug PVS-1342 “Underlying data issues”, with
slighly more diplomatic wording. It’s my expectation that I’d get the
same results by querying <a href="https://www.uspto.gov/patents/search/patent-public-search" class="external-link">ppubs’
advanced search</a> as I would with patentsview. Differences due to
disambiguation would be one thing, but I’m expecting the underlying data
to be the same.</p>
<ul>
<li><p>One of the weirdest things is that there are approximately 8000
withdrawn patents in the patentsview database. The source of the
database is the <a href="https://bulkdata.uspto.gov/" class="external-link">bulk xml files</a>
the US Patent Office releases weekly. The problem is that sometimes
patents are withdrawn after appearing in a bulk xml file but they are
kept in the patentsview database alongside non withdrawn patents. How
weird is that? Here is the Patent Office’s <a href="http://www.uspto.gov/patents-application-process/patent-search/withdrawn-patent-numbers" class="external-link">withdrawn
patent list</a>, which is updated weekly. See test_that(“withdrawn
patents are still present in the database”) in test-api-bugs.R</p></li>
<li><p>An equally strange situation is the approximately 300
non-withdrawn patents that, for whatever reason, did not appear in the
bulk xml file for the week they were issued. They are granted patents
that are not in the patentsview database. See test_that(“missing patents
are still missing”) in test-api-bugs.R</p></li>
<li><p>Also, not sure why, but there aren’t any design patents before
1976-12-07 or plant patents before 1976-12-14 while there are utility
and reissue patents starting 1976-01-06<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Observation sent to the API team.&lt;/p&gt;"><sup>6</sup></a>. See <a href="result-set-paging.html#missing">this page</a></p></li>
<li>
<p>Plant patents and reissued patents do not have current CPC
assignments where appropriate. The problem is that the bulk Cooperative
Patent Classification file for granted patents, produced the USPTO
quarterly, only contains assignments for utility patents. I didn’t check
but am assuming the USPTO’s bulk CPC file for applications only contains
current CPCs for utility patents.</p>
<p>The patentsview database does have cpc_at_issue fields for these
patents but they only have cpc_current fields for utility patents. E.g.,
thousands of plant patents have A01H 5/02 as one of their current CPCs
in <a href="https://ppubs.uspto.gov/pubwebapp/external.html?db=USPAT&amp;type=queryString&amp;q=PP%24.pn.%20AND%20A01H5/02.cpc." class="external-link">ppubs</a>
yet none have it in the patentsview database.</p>
</li>
<li>
<p>There is a similar problem with USPCs. The US Patent stopped
assigning them to utility patent in 2015, in favor of CPCs. They are
still used, however, on plant patents, yet the US Patent office stopped
producing a bulk file of USPCs in 2018. Plant patents do have their
uspc_at_issue fields set in the patentsview database, but the API does
not have a uspc_current field.</p>
<p>The lack of current CPCs and USPCs on plant patents means your
classification searches aren’t being preformed on the same version of
the corresponding classification system. Here’s a page showing how often
the <a href="https://www.cooperativepatentclassification.org/cpcSchemeAndDefinitions" class="external-link">CPC
changes</a>. Here’s a page that shows that <a href="https://www.uspto.gov/patents/search/understanding-patent-classifications/classification-orders" class="external-link">USPC
change orders</a> stopped in 2013. If you are doing classification
searches on plant patents, you may want to use <a href="https://ppubs.uspto.gov/pubwebapp/" class="external-link">ppubs</a> or some other
system.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="open-api-bugs">Open API Bugs<a class="anchor" aria-label="anchor" href="#open-api-bugs"></a>
</h2>
<p>Weirdly, you can only view bugs you’ve submitted. Based on the digits
in the reference number, I’m assuming there are other open bugs.</p>
<p><del>PVS-1109</del> <a name="otherreference">This is fixed<br>
The other_reference endpoint rejects the default </a><a href="https://search.patentsview.org/swagger-ui/" class="external-link">Swagger UI</a>
parameters (throws a 400 Bad Request Error if either reference_sequence
or reference_text is requested) and returns no data when only patent_id
is requested. See test_that(“the otherreferences endpoint is still
broken”) in test-api-bugs.R Also, the OpenAPI object says the returned
object is other_references which is another exception to the singular
endpoint/plural return pattern<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;To be fixed by the API team&lt;/p&gt;"><sup>7</sup></a>.</p>
<p>PVS-1125 Not all the fields in the OpenAPI object can be requested
See test_that(“each field in fieldsdf can be retrieved”) in
test-api-bugs.R</p>
<p>PVS-1147 <a name="case-dependent"> Results are case dependent now
when using an implied or explicit equals See test_that(“there is case
sensitivity on string equals”) in test-api-bugs.R</a></p>
<p><del>PVS-1155</del> This is fixed<br>
Documentation inconsistencies<br>
The endpoint is listed as /api/v1/attorney/, it should be
/api/v1/patent/attorney for the GET/POST and
/api/v1/patent/attorney/{attorney_id}/ for the GET with a url parameter
The beta endpoints say they are only GETs. The Swagger UI page and
OpenAPI object say they accept posts too, which do work.</p>
<p>PVS-1181<br>
Improvement Suggestion<br>
There isn’t a data dictionary for the API like there is for the bulk
download files. A specific question would be what is the difference
between patent_earliest_application_date and application.filing_date
returned by the new patent endpoint. Other questions would be what do
the values of the assignees.assignee_type field represent, are they all
integers and if so should the field be received as an integer rather
than a string? Another question is what does g_claims’ exemplary
represent? The values seem to be either “0” or “1”.<br>
At a minimum, I’d like to see the glossary updated <a href="https://patentsview.org/glossary" class="external-link uri">https://patentsview.org/glossary</a></p>
<p>PVS-1218 openapi.json errors</p>
<ul>
<li><p>Fixed: <del>“publication”,“us_parties.applicant_authority” has a
type of “keyword” when it should be “string”</del></p></li>
<li><p>There are two rule_47_flag fields, one is a boolean (line 7019),
the other is a string (line 8004)</p></li>
<li><p>Most of the document_numbers are integers but
citation_document_number from patent/us_application_citation is a
string. document_number from publication/rel_app_text is now correctly
coming back as an integer.</p></li>
</ul>
<p><del>PVS-1306</del> This is fixed<br>
The API accepts invalid fields<br>
The API accepts invalid fields that start out looking like valid fields
when it should throw an error. Ex f: is[“patent_iddddddddddddd”,
“patent_dateagogo”] and q: is {“patent_idd”:“10000000”} with this
result: { “error”: false, “count”: 0, “total_hits”: 0, “patents”: [] }
See test_that(“invalid fields are accepted”) in test-api-bugs.R</p>
<p>PVS-1342<br>
Underlying data issues<br>
There are ~300 issued patents are missing from the database, ~8000
withdrawn patents are present in the database, and plant patents and
reissued patents don’t have current CPC assigments when applicable. I
didn’t check but am assuming the bulk CPC file for applications and the
publication endpoint have the same issue. (There’s more detail above as
the last API oddity)</p>
<p>PVS-1377<br>
The sort field doesn’t accept all unnested fields<br>
The API throws errors when some fields are specified as the sort,
e.g. patent_title at the patent endpoint. 39 other endpoint/field pairs
currently fail. See test_that(“we can’t sort by all fields”) in
test-api-bugs.R</p>
<p>Unknown Reference Number<br>
A sort field needs to be specified when paging results.<br>
This was mentioned as a bug in the <a href="https://patentsview.org/forum/7/topic/804#comment-749" class="external-link">API’s
forum</a>. It causes some awkardness in search_pv (we add a sort field
and the primary key if not included in fields. Awkard if no fields were
specified)</p>
<p><a name="paging-change">PVS-1435<br><strong>Paging seems to have been changed with a recent API
release</strong><br>
test_that(“the ‘after’ parameter works properly”) in test-search-pv.R
broke, as did the </a><a href="result-set-paging.html">paging vignette</a>.
Their first requests have a total_hits of 3003 with 1000 rows returned
but the subsequent requests return 399 rows when we set the ‘after’
parameter to the unaltered value of the last patent_id we received.</p>
<p>Here’s the new reality: if the after: parameter is the value of a
patent_id, it needs to be padded to 8 characters. E.g. “6010555” needs
to be submitted as <code>{"after": "06010555"}</code>, “RE36479” needs
to become <code>{"after": "RE036479"}</code>. This seems to be an
intentional change so that sorting by patent_id doesn’t behave oddly
above and below 10,000,000 (where the leading 1 put anything above 10M
before anything below 10M). As a result, sorting/paging by patent_id now
requires padding. Oh, and the R package has a new method,
<code><a href="../reference/pad_patent_id.html">pad_patent_id()</a></code> should you need to pad patent_ids. See
Example 1 in the Result Set Paging <a href="result-set-paging.html#example-1">vignette</a></p>
</div>
<div class="section level2">
<h2 id="state-of-the-r-package">State of the R Package<a class="anchor" aria-label="anchor" href="#state-of-the-r-package"></a>
</h2>
<ul>
<li><p><a href="api-changes.html#additional-r-package-changes">Three new
methods</a> were added to the R package</p></li>
<li><p>The reworked <a href="ropensci-blog-post.html">ropensci post</a>
explains what changes had to be made since assignee latitude and
longitude are no longer available from the patent endpoint.</p></li>
<li>
<p><a name="new-vignette">A new vignette</a>, inspired by the API
team’s jupyter notebook, was created showing two of the things it
mentions</p>
<ol style="list-style-type: decimal">
<li>The API and now the R package allow nested attributes to be <a href="understanding-the-api.html#fields-shorthand">wildcarded</a>, where
the group’s name will retrieve all the group’s nested fields. Oddly, the
unnested attributes cannot be requested this way, e.g. the unnested
attributes of the patent endpoint need to be called out, rather than
requesting “patents” as a field.</li>
</ol>
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="co"># top level/unnested attributes at the patent endpoint</span></span>
<span>   <span class="fu"><a href="../reference/get_fields.html">get_fields</a></span><span class="op">(</span><span class="st">"patent"</span>, groups <span class="op">=</span> <span class="st">"patents"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "gov_interest_statement"                                      </span></span>
<span><span class="co">##  [2] "patent_abstract"                                             </span></span>
<span><span class="co">##  [3] "patent_cpc_current_group_average_patent_processing_days"     </span></span>
<span><span class="co">##  [4] "patent_date"                                                 </span></span>
<span><span class="co">##  [5] "patent_detail_desc_length"                                   </span></span>
<span><span class="co">##  [6] "patent_earliest_application_date"                            </span></span>
<span><span class="co">##  [7] "patent_id"                                                   </span></span>
<span><span class="co">##  [8] "patent_num_foreign_documents_cited"                          </span></span>
<span><span class="co">##  [9] "patent_num_times_cited_by_us_patents"                        </span></span>
<span><span class="co">## [10] "patent_num_total_documents_cited"                            </span></span>
<span><span class="co">## [11] "patent_num_us_applications_cited"                            </span></span>
<span><span class="co">## [12] "patent_num_us_patents_cited"                                 </span></span>
<span><span class="co">## [13] "patent_processing_days"                                      </span></span>
<span><span class="co">## [14] "patent_term_extension"                                       </span></span>
<span><span class="co">## [15] "patent_title"                                                </span></span>
<span><span class="co">## [16] "patent_type"                                                 </span></span>
<span><span class="co">## [17] "patent_uspc_current_mainclass_average_patent_processing_days"</span></span>
<span><span class="co">## [18] "patent_year"                                                 </span></span>
<span><span class="co">## [19] "wipo_kind"                                                   </span></span>
<span><span class="co">## [20] "withdrawn"</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="co"># all attributes at the patent endpoint using the new group shorthand</span></span>
<span>   <span class="co"># the first 19 are the unnested attributes, the remaining ones are group names</span></span>
<span>   <span class="fu"><a href="../reference/get_fields.html">get_fields</a></span><span class="op">(</span><span class="st">"patent"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1] "applicants.applicant_designation"                            </span></span>
<span><span class="co">##   [2] "applicants.applicant_name_first"                             </span></span>
<span><span class="co">##   [3] "applicants.applicant_name_last"                              </span></span>
<span><span class="co">##   [4] "applicants.applicant_organization"                           </span></span>
<span><span class="co">##   [5] "applicants.applicant_sequence"                               </span></span>
<span><span class="co">##   [6] "applicants.applicant_type"                                   </span></span>
<span><span class="co">##   [7] "applicants.location_id"                                      </span></span>
<span><span class="co">##   [8] "application.application_id"                                  </span></span>
<span><span class="co">##   [9] "application.application_type"                                </span></span>
<span><span class="co">##  [10] "application.filing_date"                                     </span></span>
<span><span class="co">##  [11] "application.filing_type"                                     </span></span>
<span><span class="co">##  [12] "application.rule_47_flag"                                    </span></span>
<span><span class="co">##  [13] "application.series_code"                                     </span></span>
<span><span class="co">##  [14] "assignees.assignee_id"                                       </span></span>
<span><span class="co">##  [15] "assignees.assignee_city"                                     </span></span>
<span><span class="co">##  [16] "assignees.assignee_country"                                  </span></span>
<span><span class="co">##  [17] "assignees.assignee_individual_name_first"                    </span></span>
<span><span class="co">##  [18] "assignees.assignee_individual_name_last"                     </span></span>
<span><span class="co">##  [19] "assignees.assignee_organization"                             </span></span>
<span><span class="co">##  [20] "assignees.assignee_sequence"                                 </span></span>
<span><span class="co">##  [21] "assignees.assignee_state"                                    </span></span>
<span><span class="co">##  [22] "assignees.assignee_type"                                     </span></span>
<span><span class="co">##  [23] "attorneys.attorney_id"                                       </span></span>
<span><span class="co">##  [24] "attorneys.attorney_name_first"                               </span></span>
<span><span class="co">##  [25] "attorneys.attorney_name_last"                                </span></span>
<span><span class="co">##  [26] "attorneys.attorney_organization"                             </span></span>
<span><span class="co">##  [27] "attorneys.attorney_sequence"                                 </span></span>
<span><span class="co">##  [28] "botanic.latin_name"                                          </span></span>
<span><span class="co">##  [29] "botanic.variety"                                             </span></span>
<span><span class="co">##  [30] "cpc_at_issue.cpc_class"                                      </span></span>
<span><span class="co">##  [31] "cpc_at_issue.cpc_class_id"                                   </span></span>
<span><span class="co">##  [32] "cpc_at_issue.cpc_group"                                      </span></span>
<span><span class="co">##  [33] "cpc_at_issue.cpc_group_id"                                   </span></span>
<span><span class="co">##  [34] "cpc_at_issue.cpc_section"                                    </span></span>
<span><span class="co">##  [35] "cpc_at_issue.cpc_sequence"                                   </span></span>
<span><span class="co">##  [36] "cpc_at_issue.cpc_subclass"                                   </span></span>
<span><span class="co">##  [37] "cpc_at_issue.cpc_subclass_id"                                </span></span>
<span><span class="co">##  [38] "cpc_at_issue.cpc_type"                                       </span></span>
<span><span class="co">##  [39] "cpc_current.cpc_class"                                       </span></span>
<span><span class="co">##  [40] "cpc_current.cpc_class_id"                                    </span></span>
<span><span class="co">##  [41] "cpc_current.cpc_group"                                       </span></span>
<span><span class="co">##  [42] "cpc_current.cpc_group_id"                                    </span></span>
<span><span class="co">##  [43] "cpc_current.cpc_section"                                     </span></span>
<span><span class="co">##  [44] "cpc_current.cpc_sequence"                                    </span></span>
<span><span class="co">##  [45] "cpc_current.cpc_subclass"                                    </span></span>
<span><span class="co">##  [46] "cpc_current.cpc_subclass_id"                                 </span></span>
<span><span class="co">##  [47] "cpc_current.cpc_type"                                        </span></span>
<span><span class="co">##  [48] "examiners.art_group"                                         </span></span>
<span><span class="co">##  [49] "examiners.examiner_first_name"                               </span></span>
<span><span class="co">##  [50] "examiners.examiner_id"                                       </span></span>
<span><span class="co">##  [51] "examiners.examiner_last_name"                                </span></span>
<span><span class="co">##  [52] "examiners.examiner_role"                                     </span></span>
<span><span class="co">##  [53] "figures.num_figures"                                         </span></span>
<span><span class="co">##  [54] "figures.num_sheets"                                          </span></span>
<span><span class="co">##  [55] "foreign_priority.filing_date"                                </span></span>
<span><span class="co">##  [56] "foreign_priority.foreign_application_id"                     </span></span>
<span><span class="co">##  [57] "foreign_priority.foreign_country_filed"                      </span></span>
<span><span class="co">##  [58] "foreign_priority.priority_claim_kind"                        </span></span>
<span><span class="co">##  [59] "foreign_priority.priority_claim_sequence"                    </span></span>
<span><span class="co">##  [60] "gov_interest_contract_award_numbers.award_number"            </span></span>
<span><span class="co">##  [61] "gov_interest_organizations.fedagency_name"                   </span></span>
<span><span class="co">##  [62] "gov_interest_organizations.level_one"                        </span></span>
<span><span class="co">##  [63] "gov_interest_organizations.level_three"                      </span></span>
<span><span class="co">##  [64] "gov_interest_organizations.level_two"                        </span></span>
<span><span class="co">##  [65] "granted_pregrant_crosswalk.application_number"               </span></span>
<span><span class="co">##  [66] "granted_pregrant_crosswalk.document_number"                  </span></span>
<span><span class="co">##  [67] "inventors.inventor_id"                                       </span></span>
<span><span class="co">##  [68] "inventors.inventor_city"                                     </span></span>
<span><span class="co">##  [69] "inventors.inventor_country"                                  </span></span>
<span><span class="co">##  [70] "inventors.inventor_name_first"                               </span></span>
<span><span class="co">##  [71] "inventors.inventor_name_last"                                </span></span>
<span><span class="co">##  [72] "inventors.inventor_sequence"                                 </span></span>
<span><span class="co">##  [73] "inventors.inventor_state"                                    </span></span>
<span><span class="co">##  [74] "ipcr.ipc_action_date"                                        </span></span>
<span><span class="co">##  [75] "ipcr.ipc_class"                                              </span></span>
<span><span class="co">##  [76] "ipcr.ipc_classification_data_source"                         </span></span>
<span><span class="co">##  [77] "ipcr.ipc_classification_value"                               </span></span>
<span><span class="co">##  [78] "ipcr.ipc_id"                                                 </span></span>
<span><span class="co">##  [79] "ipcr.ipc_main_group"                                         </span></span>
<span><span class="co">##  [80] "ipcr.ipc_section"                                            </span></span>
<span><span class="co">##  [81] "ipcr.ipc_sequence"                                           </span></span>
<span><span class="co">##  [82] "ipcr.ipc_subclass"                                           </span></span>
<span><span class="co">##  [83] "ipcr.ipc_subgroup"                                           </span></span>
<span><span class="co">##  [84] "ipcr.ipc_symbol_position"                                    </span></span>
<span><span class="co">##  [85] "gov_interest_statement"                                      </span></span>
<span><span class="co">##  [86] "patent_abstract"                                             </span></span>
<span><span class="co">##  [87] "patent_cpc_current_group_average_patent_processing_days"     </span></span>
<span><span class="co">##  [88] "patent_date"                                                 </span></span>
<span><span class="co">##  [89] "patent_detail_desc_length"                                   </span></span>
<span><span class="co">##  [90] "patent_earliest_application_date"                            </span></span>
<span><span class="co">##  [91] "patent_id"                                                   </span></span>
<span><span class="co">##  [92] "patent_num_foreign_documents_cited"                          </span></span>
<span><span class="co">##  [93] "patent_num_times_cited_by_us_patents"                        </span></span>
<span><span class="co">##  [94] "patent_num_total_documents_cited"                            </span></span>
<span><span class="co">##  [95] "patent_num_us_applications_cited"                            </span></span>
<span><span class="co">##  [96] "patent_num_us_patents_cited"                                 </span></span>
<span><span class="co">##  [97] "patent_processing_days"                                      </span></span>
<span><span class="co">##  [98] "patent_term_extension"                                       </span></span>
<span><span class="co">##  [99] "patent_title"                                                </span></span>
<span><span class="co">## [100] "patent_type"                                                 </span></span>
<span><span class="co">## [101] "patent_uspc_current_mainclass_average_patent_processing_days"</span></span>
<span><span class="co">## [102] "patent_year"                                                 </span></span>
<span><span class="co">## [103] "wipo_kind"                                                   </span></span>
<span><span class="co">## [104] "withdrawn"                                                   </span></span>
<span><span class="co">## [105] "pct_data.application_kind"                                   </span></span>
<span><span class="co">## [106] "pct_data.pct_102_date"                                       </span></span>
<span><span class="co">## [107] "pct_data.pct_371_date"                                       </span></span>
<span><span class="co">## [108] "pct_data.pct_doc_number"                                     </span></span>
<span><span class="co">## [109] "pct_data.pct_doc_type"                                       </span></span>
<span><span class="co">## [110] "pct_data.published_filed_date"                               </span></span>
<span><span class="co">## [111] "us_related_documents.published_country"                      </span></span>
<span><span class="co">## [112] "us_related_documents.related_doc_kind"                       </span></span>
<span><span class="co">## [113] "us_related_documents.related_doc_number"                     </span></span>
<span><span class="co">## [114] "us_related_documents.related_doc_published_date"             </span></span>
<span><span class="co">## [115] "us_related_documents.related_doc_sequence"                   </span></span>
<span><span class="co">## [116] "us_related_documents.related_doc_status"                     </span></span>
<span><span class="co">## [117] "us_related_documents.related_doc_type"                       </span></span>
<span><span class="co">## [118] "us_related_documents.wipo_kind"                              </span></span>
<span><span class="co">## [119] "us_term_of_grant.disclaimer_date"                            </span></span>
<span><span class="co">## [120] "us_term_of_grant.term_disclaimer"                            </span></span>
<span><span class="co">## [121] "us_term_of_grant.term_extension"                             </span></span>
<span><span class="co">## [122] "us_term_of_grant.term_grant"                                 </span></span>
<span><span class="co">## [123] "uspc_at_issue.uspc_mainclass"                                </span></span>
<span><span class="co">## [124] "uspc_at_issue.uspc_mainclass_id"                             </span></span>
<span><span class="co">## [125] "uspc_at_issue.uspc_sequence"                                 </span></span>
<span><span class="co">## [126] "uspc_at_issue.uspc_subclass"                                 </span></span>
<span><span class="co">## [127] "uspc_at_issue.uspc_subclass_id"                              </span></span>
<span><span class="co">## [128] "wipo.wipo_field"                                             </span></span>
<span><span class="co">## [129] "wipo.wipo_field_id"                                          </span></span>
<span><span class="co">## [130] "wipo.wipo_sequence"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="co"># all attributes at the patent endpoint, fully qualified.  With a modest query this can</span></span>
<span>   <span class="co"># be too much to send via a GET request</span></span>
<span>   <span class="va">fieldsdf</span><span class="op">[</span><span class="va">fieldsdf</span><span class="op">$</span><span class="va">endpoint</span> <span class="op">==</span> <span class="st">"patent"</span>, <span class="st">"field"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1] "applicants.applicant_designation"                            </span></span>
<span><span class="co">##   [2] "applicants.applicant_name_first"                             </span></span>
<span><span class="co">##   [3] "applicants.applicant_name_last"                              </span></span>
<span><span class="co">##   [4] "applicants.applicant_organization"                           </span></span>
<span><span class="co">##   [5] "applicants.applicant_sequence"                               </span></span>
<span><span class="co">##   [6] "applicants.applicant_type"                                   </span></span>
<span><span class="co">##   [7] "applicants.location_id"                                      </span></span>
<span><span class="co">##   [8] "application.application_id"                                  </span></span>
<span><span class="co">##   [9] "application.application_type"                                </span></span>
<span><span class="co">##  [10] "application.filing_date"                                     </span></span>
<span><span class="co">##  [11] "application.filing_type"                                     </span></span>
<span><span class="co">##  [12] "application.rule_47_flag"                                    </span></span>
<span><span class="co">##  [13] "application.series_code"                                     </span></span>
<span><span class="co">##  [14] "assignees.assignee_id"                                       </span></span>
<span><span class="co">##  [15] "assignees.assignee_city"                                     </span></span>
<span><span class="co">##  [16] "assignees.assignee_country"                                  </span></span>
<span><span class="co">##  [17] "assignees.assignee_individual_name_first"                    </span></span>
<span><span class="co">##  [18] "assignees.assignee_individual_name_last"                     </span></span>
<span><span class="co">##  [19] "assignees.assignee_organization"                             </span></span>
<span><span class="co">##  [20] "assignees.assignee_sequence"                                 </span></span>
<span><span class="co">##  [21] "assignees.assignee_state"                                    </span></span>
<span><span class="co">##  [22] "assignees.assignee_type"                                     </span></span>
<span><span class="co">##  [23] "attorneys.attorney_id"                                       </span></span>
<span><span class="co">##  [24] "attorneys.attorney_name_first"                               </span></span>
<span><span class="co">##  [25] "attorneys.attorney_name_last"                                </span></span>
<span><span class="co">##  [26] "attorneys.attorney_organization"                             </span></span>
<span><span class="co">##  [27] "attorneys.attorney_sequence"                                 </span></span>
<span><span class="co">##  [28] "botanic.latin_name"                                          </span></span>
<span><span class="co">##  [29] "botanic.variety"                                             </span></span>
<span><span class="co">##  [30] "cpc_at_issue.cpc_class"                                      </span></span>
<span><span class="co">##  [31] "cpc_at_issue.cpc_class_id"                                   </span></span>
<span><span class="co">##  [32] "cpc_at_issue.cpc_group"                                      </span></span>
<span><span class="co">##  [33] "cpc_at_issue.cpc_group_id"                                   </span></span>
<span><span class="co">##  [34] "cpc_at_issue.cpc_section"                                    </span></span>
<span><span class="co">##  [35] "cpc_at_issue.cpc_sequence"                                   </span></span>
<span><span class="co">##  [36] "cpc_at_issue.cpc_subclass"                                   </span></span>
<span><span class="co">##  [37] "cpc_at_issue.cpc_subclass_id"                                </span></span>
<span><span class="co">##  [38] "cpc_at_issue.cpc_type"                                       </span></span>
<span><span class="co">##  [39] "cpc_current.cpc_class"                                       </span></span>
<span><span class="co">##  [40] "cpc_current.cpc_class_id"                                    </span></span>
<span><span class="co">##  [41] "cpc_current.cpc_group"                                       </span></span>
<span><span class="co">##  [42] "cpc_current.cpc_group_id"                                    </span></span>
<span><span class="co">##  [43] "cpc_current.cpc_section"                                     </span></span>
<span><span class="co">##  [44] "cpc_current.cpc_sequence"                                    </span></span>
<span><span class="co">##  [45] "cpc_current.cpc_subclass"                                    </span></span>
<span><span class="co">##  [46] "cpc_current.cpc_subclass_id"                                 </span></span>
<span><span class="co">##  [47] "cpc_current.cpc_type"                                        </span></span>
<span><span class="co">##  [48] "examiners.art_group"                                         </span></span>
<span><span class="co">##  [49] "examiners.examiner_first_name"                               </span></span>
<span><span class="co">##  [50] "examiners.examiner_id"                                       </span></span>
<span><span class="co">##  [51] "examiners.examiner_last_name"                                </span></span>
<span><span class="co">##  [52] "examiners.examiner_role"                                     </span></span>
<span><span class="co">##  [53] "figures.num_figures"                                         </span></span>
<span><span class="co">##  [54] "figures.num_sheets"                                          </span></span>
<span><span class="co">##  [55] "foreign_priority.filing_date"                                </span></span>
<span><span class="co">##  [56] "foreign_priority.foreign_application_id"                     </span></span>
<span><span class="co">##  [57] "foreign_priority.foreign_country_filed"                      </span></span>
<span><span class="co">##  [58] "foreign_priority.priority_claim_kind"                        </span></span>
<span><span class="co">##  [59] "foreign_priority.priority_claim_sequence"                    </span></span>
<span><span class="co">##  [60] "gov_interest_contract_award_numbers.award_number"            </span></span>
<span><span class="co">##  [61] "gov_interest_organizations.fedagency_name"                   </span></span>
<span><span class="co">##  [62] "gov_interest_organizations.level_one"                        </span></span>
<span><span class="co">##  [63] "gov_interest_organizations.level_three"                      </span></span>
<span><span class="co">##  [64] "gov_interest_organizations.level_two"                        </span></span>
<span><span class="co">##  [65] "granted_pregrant_crosswalk.application_number"               </span></span>
<span><span class="co">##  [66] "granted_pregrant_crosswalk.document_number"                  </span></span>
<span><span class="co">##  [67] "inventors.inventor_id"                                       </span></span>
<span><span class="co">##  [68] "inventors.inventor_city"                                     </span></span>
<span><span class="co">##  [69] "inventors.inventor_country"                                  </span></span>
<span><span class="co">##  [70] "inventors.inventor_name_first"                               </span></span>
<span><span class="co">##  [71] "inventors.inventor_name_last"                                </span></span>
<span><span class="co">##  [72] "inventors.inventor_sequence"                                 </span></span>
<span><span class="co">##  [73] "inventors.inventor_state"                                    </span></span>
<span><span class="co">##  [74] "ipcr.ipc_action_date"                                        </span></span>
<span><span class="co">##  [75] "ipcr.ipc_class"                                              </span></span>
<span><span class="co">##  [76] "ipcr.ipc_classification_data_source"                         </span></span>
<span><span class="co">##  [77] "ipcr.ipc_classification_value"                               </span></span>
<span><span class="co">##  [78] "ipcr.ipc_id"                                                 </span></span>
<span><span class="co">##  [79] "ipcr.ipc_main_group"                                         </span></span>
<span><span class="co">##  [80] "ipcr.ipc_section"                                            </span></span>
<span><span class="co">##  [81] "ipcr.ipc_sequence"                                           </span></span>
<span><span class="co">##  [82] "ipcr.ipc_subclass"                                           </span></span>
<span><span class="co">##  [83] "ipcr.ipc_subgroup"                                           </span></span>
<span><span class="co">##  [84] "ipcr.ipc_symbol_position"                                    </span></span>
<span><span class="co">##  [85] "gov_interest_statement"                                      </span></span>
<span><span class="co">##  [86] "patent_abstract"                                             </span></span>
<span><span class="co">##  [87] "patent_cpc_current_group_average_patent_processing_days"     </span></span>
<span><span class="co">##  [88] "patent_date"                                                 </span></span>
<span><span class="co">##  [89] "patent_detail_desc_length"                                   </span></span>
<span><span class="co">##  [90] "patent_earliest_application_date"                            </span></span>
<span><span class="co">##  [91] "patent_id"                                                   </span></span>
<span><span class="co">##  [92] "patent_num_foreign_documents_cited"                          </span></span>
<span><span class="co">##  [93] "patent_num_times_cited_by_us_patents"                        </span></span>
<span><span class="co">##  [94] "patent_num_total_documents_cited"                            </span></span>
<span><span class="co">##  [95] "patent_num_us_applications_cited"                            </span></span>
<span><span class="co">##  [96] "patent_num_us_patents_cited"                                 </span></span>
<span><span class="co">##  [97] "patent_processing_days"                                      </span></span>
<span><span class="co">##  [98] "patent_term_extension"                                       </span></span>
<span><span class="co">##  [99] "patent_title"                                                </span></span>
<span><span class="co">## [100] "patent_type"                                                 </span></span>
<span><span class="co">## [101] "patent_uspc_current_mainclass_average_patent_processing_days"</span></span>
<span><span class="co">## [102] "patent_year"                                                 </span></span>
<span><span class="co">## [103] "wipo_kind"                                                   </span></span>
<span><span class="co">## [104] "withdrawn"                                                   </span></span>
<span><span class="co">## [105] "pct_data.application_kind"                                   </span></span>
<span><span class="co">## [106] "pct_data.pct_102_date"                                       </span></span>
<span><span class="co">## [107] "pct_data.pct_371_date"                                       </span></span>
<span><span class="co">## [108] "pct_data.pct_doc_number"                                     </span></span>
<span><span class="co">## [109] "pct_data.pct_doc_type"                                       </span></span>
<span><span class="co">## [110] "pct_data.published_filed_date"                               </span></span>
<span><span class="co">## [111] "us_related_documents.published_country"                      </span></span>
<span><span class="co">## [112] "us_related_documents.related_doc_kind"                       </span></span>
<span><span class="co">## [113] "us_related_documents.related_doc_number"                     </span></span>
<span><span class="co">## [114] "us_related_documents.related_doc_published_date"             </span></span>
<span><span class="co">## [115] "us_related_documents.related_doc_sequence"                   </span></span>
<span><span class="co">## [116] "us_related_documents.related_doc_status"                     </span></span>
<span><span class="co">## [117] "us_related_documents.related_doc_type"                       </span></span>
<span><span class="co">## [118] "us_related_documents.wipo_kind"                              </span></span>
<span><span class="co">## [119] "us_term_of_grant.disclaimer_date"                            </span></span>
<span><span class="co">## [120] "us_term_of_grant.term_disclaimer"                            </span></span>
<span><span class="co">## [121] "us_term_of_grant.term_extension"                             </span></span>
<span><span class="co">## [122] "us_term_of_grant.term_grant"                                 </span></span>
<span><span class="co">## [123] "uspc_at_issue.uspc_mainclass"                                </span></span>
<span><span class="co">## [124] "uspc_at_issue.uspc_mainclass_id"                             </span></span>
<span><span class="co">## [125] "uspc_at_issue.uspc_sequence"                                 </span></span>
<span><span class="co">## [126] "uspc_at_issue.uspc_subclass"                                 </span></span>
<span><span class="co">## [127] "uspc_at_issue.uspc_subclass_id"                              </span></span>
<span><span class="co">## [128] "wipo.wipo_field"                                             </span></span>
<span><span class="co">## [129] "wipo.wipo_field_id"                                          </span></span>
<span><span class="co">## [130] "wipo.wipo_sequence"</span></span></code></pre>
<ol start="2" style="list-style-type: decimal">
<li>On <a href="understanding-the-api.html#unexpected-results">applying
multiple conditions to related-entity fields</a>
</li>
</ol>
<ul>
<li>
<p>The endpoints are now singular, to match the API’s change. Some
of the new endpoints are nested under patent/ and one is nested under
publication/, also matching the API’s change</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">fieldsdf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"/"</span>, <span class="va">fieldsdf</span><span class="op">$</span><span class="va">endpoint</span><span class="op">)</span>, <span class="st">"endpoint"</span><span class="op">]</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "patent/attorney"                "patent/foreign_citation"       </span></span>
<span><span class="co">## [3] "patent/other_reference"         "patent/rel_app_text"           </span></span>
<span><span class="co">## [5] "patent/us_application_citation" "patent/us_patent_citation"     </span></span>
<span><span class="co">## [7] "publication/rel_app_text"</span></span></code></pre>
</li>
<li><p>Under the covers, httr was changed to httr2 (see several mentions
below). This only matters to users if they passed additional arguments
(…) to <code><a href="../reference/search_pv.html">search_pv()</a></code>. Previously if they passed config =
httr::timeout(40) they’d now pass timeout = 40 (name-value pairs of
valid curl options, as found in
<code><a href="https://jeroen.r-universe.dev/curl/reference/curl_options.html" class="external-link">curl::curl_options()</a></code>)</p></li>
<li><p>Now that the R package is using httr2, users can make use of its
last_request() method to see what was sent to the API. This could be
useful when trying to fix an invalid request. Note that when
<code>all_pages = TRUE</code> the R package changes the sort parameter
(details <a href="result-set-paging.html">here</a>) and sets the ‘after’
options parameter so the request shown might not be what you’d expect it
to be. Also fun, or useful, when reporting a bug, would be seeing the
raw API response.</p></li>
</ul>
<pre><code><span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/last_response.html" class="external-link">last_request</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/last_response.html" class="external-link">last_response</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/last_response.html" class="external-link">last_response</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre>
<ul>
<li>
<p>Package contributor specific changes</p>
<ul>
<li><p>Changed httr to httr2 as <a href="https://httr.r-lib.org/index.html" class="external-link">httr</a> says it’s superseded
by <a href="https://httr2.r-lib.org/" class="external-link">httr2</a> It’s trying to put us
out of business by handling 429 retries etc. See their <a href="https://httr2.r-lib.org/articles/wrapping-apis.html" class="external-link">Wrapping APIs
vignette</a></p></li>
<li><p>My github repo is set to deliver to <a href="https://mustberuss.r-universe.dev/patentsview" class="external-link uri">https://mustberuss.r-universe.dev/patentsview</a>. The new
version of the R package can be installed via<br><code>install.packages('patentsview', repos = c('https://mustberuss.r-universe.dev'))</code></p></li>
<li><p>On the new <a href="api-changes.html#a-note-on-paging">implementation of paging</a>
and the <a href="https://github.com/ropensci/patentsview/pull/29#discussion_r1059153136" class="external-link">PR
discussion</a> on paging with more than a primary sort. There is also a
<a href="result-set-paging.html">new vignette</a> on the API’s new
mechanism to page through the result set (<code>per_page</code> and
<code>page</code> parameters have been replaced by <code>size</code> and
<code>after</code>).</p></li>
<li><p>The R package unit tests have some skips and other negative tests
that API bugs still exist (they’ll fail when bugs are fixed).</p></li>
<li>
<p>A possible <a href="patentsview-breaking-release.html">tech
note</a> for when the new package is ready mentions</p>
<blockquote>
<p>As shown in the updated <a href="top-assignees.html">Top Assignees
vignette</a>, there will be occasions now where multiple API calls are
needed to retrieve the same data as in a single API call in the original
version of the API and R package.</p>
</blockquote>
</li>
<li><p>The workflow (R-CMD-check.yaml) was updated to get rid of
deprecated warnings</p></li>
<li><p>Added vignettes/build_some.R to half render one or more of the
vignettes during development</p></li>
<li><p>Added a <code>bootstrap: 5</code> to _pkgdown.yml so the search
box would display (Maëlle’s <a href="https://github.com/ropensci/patentsview/pull/34" class="external-link">PR</a>)</p></li>
<li><p>The R package handles <a href="api-changes.html#throttling">throttling</a>, which the new version
of the API now imposes</p></li>
<li><p>data-raw/fieldsdf.R is working again! There is some hard-coding
that can be removed when bugs are fixed. We may need to retain some of
the hard-coding, see the comments in data-raw/fieldsdf.R</p></li>
<li><p>renamed test-arg-validation.R to test-validate-args.R for code
coverage match up</p></li>
<li>
<p><a name="improvements"> Possible Package Improvements</a></p>
<ul>
<li><p>The version number ought to be bumped to 1.0.0 since there are
breaking API changes (singular endpoints and the addition of an API
key). validate-args.R has some version specific code that may need
modifying. A draft of a release would look something like this: <img src="https://patentsview.historicip.com/release.png" alt="pre-release"></p></li>
<li><p>Result set size seems unbounded now. Should we warn if a query
would return more than 100,000 rows with all_pages = TRUE? Or maybe add
a max_rows to search_pv()?</p></li>
<li><p>Have get_fields() and search_pv() throw a specialized error if a
plural endpoint is passed</p></li>
<li><p>Add an issue template that warns users not to share their API
key</p></li>
<li><p>Add a contributing.md or something that explains how to build
everything, something like <a href="#findingscontributor-101">Findings/Contributor 101</a>
below</p></li>
<li><p>Navigation on the vignettes could be better, should the possible
<a href="patentsview-breaking-release.html">tech note</a> be added to
the nav?</p></li>
<li><p>Not sure if there should be a monster comment in search_pv.R
trying to explain the new way of paging. Possibly just say to see the
new <a href="result-set-paging.html">api paging vignette</a>?</p></li>
<li>
<p>httr2 improvements</p>
<ul>
<li>Currently requests are set to be retried 19 times
<code>httr2::req_retry(max_tries = 20)</code> Is this a reasonable
number? 429 errors can occur if the user runs more than a single program
at a time, like half rendering while devtools::test() is running or
running anything locally while an action is running in your repo because
of a push. Errors did not occur when the retries were recursive, whether
that was intended or not!</li>
<li>Can the throttled test detect output to stdout etc? We used to
expect_message “The API’s requests per minute limit has been reached.”
Now “Waiting 45s for retry backoff” appears but doesn’t satisfy
expect_message(). Currently it’s using system.time() to assert that 50
transactions took over 60 seconds, implying that throttling
occurred.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="worth-monitoring">Worth Monitoring<a class="anchor" aria-label="anchor" href="#worth-monitoring"></a>
</h2>
<p>bergant/rapiclient has a new maintainer and <a href="https://github.com/bergant/rapiclient/issues/11#issuecomment-2383483280" class="external-link">he’s
in favor</a> of supporting OpenAPI v3 though he thinks that would
warrant a new package. The R version of the fieldsdf creator is working
again! It uses rapiclient which is expecting to read a Swagger/OpenAPI
v2 object (the patentsview object is OpenAPI v3). It throws a warning
but seems to work otherwise.</p>
</div>
<div class="section level2">
<h2 id="findingscontributor-101">Findings/Contributor 101<a class="anchor" aria-label="anchor" href="#findingscontributor-101"></a>
</h2>
<p>Helpful info after you’ve forked <a href="https://github.com/ropensci/patentsview" class="external-link uri">https://github.com/ropensci/patentsview</a></p>
<ul>
<li>
<p>API related</p>
<ul>
<li>
<p>Updated versions of the new API are unannounced for the most
part, maybe on a three or four week release cycle, often on Saturdays. I
do head requests from time to time on the <a href="https://search.patentsview.org/static/openapi.json" class="external-link">API’s OpenAPI
object</a> to detect when its Last-Modified changes. When it changes, I
back up data-raw/fieldsdf.csv, run data-raw/fieldsdf.R and compare the
backed up fieldsdf.csv to the new one to see what, if anything, changed.
(It seems they update openapi.json on a release, whether it changed or
not.)</p>
<p>If it did change, I’ll do a local build to incorporate the changed
fieldsdf. Either way (openapi.json changed or not), I’ll run all the
tests to see if any fail, especially noting if test_that(“the endpoints
are stable”) fails, indicting changes in endpoints. I’ll then push any
changes needed to keep the R package working and the tests passing,
sometimes half rendering vignettes if they are affected by the change.
Quarterly or so they’ll update <a href="https://patentsview.org/release-notes" class="external-link uri">https://patentsview.org/release-notes</a></p>
</li>
<li><p>Request an API key, report API suggestions/bugs etc <a href="https://patentsview-support.atlassian.net/servicedesk/customer/portals" class="external-link">here</a>
or Community -&gt; Support using the nav on <a href="httsp://patentsview.org">patentsview.org</a>.</p></li>
<li><p>Now all the endpoints are documented on a <a href="https://search.patentsview.org/docs/docs/Search%20API/SearchAPIReference/#endpoints" class="external-link">single
page</a>. The <a href="https://search.patentsview.org/docs/docs/Search%20API/SearchAPIReference/#api-query-language" class="external-link">query
language</a> is also on that same page. Originally there was a separate
page for the query language and each endpoint had its own page.</p></li>
<li><p>The patentsview forum isn’t terribly active but it’s worth
keeping an eye on <a href="https://patentsview.org/forum" class="external-link uri">https://patentsview.org/forum</a></p></li>
</ul>
</li>
<li>
<p>Locally</p>
<ul>
<li>
<p>Build and install the local code
<code>devtools::install('.')</code></p>
<p>You can also do a full blown local build but you’ll need to clean up
afterwards (delete the gz and patentsview.Rcheck directory). This runs
the same things the github action runs on pushes to ropensci/patentsview
(including running the tests with skip_on_cran() being TRUE) This can be
useful to catch missing skip_on_cran()’s or undocumented parameters etc.
Without the <code>--no-manual</code> it’ll try to create a pdf of the
documentation, which can fail if pdflatex is not available. It’s
probably a good idea to run without PATENTSVIEW_API_KEY in your
environment.</p>
<pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"R CMD build ."</span><span class="op">)</span>   </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"R CMD check patentsview_1.0.0.tar.gz --no-manual --as-cran"</span><span class="op">)</span></span></code></pre>
</li>
<li><p>rscript data-raw/fieldsdf.R to run the fieldsdf creator locally.
It parses the Patentsview OpenAPI object to produce fieldsdf.csv and
fieldsdf.rda</p></li>
<li>
<p>Local Testing</p>
<ul>
<li><p>devtools::test() to run all the tests in tests/testthat/</p></li>
<li><p>devtools::test(filter=“utils”) to just run just
test-utils.R</p></li>
<li><p>note that if you add new test methods, they must start with
<code>skip_on_cran()</code> or builds will fail on r-universe (see
Optional below) and eventually on CRAN.</p></li>
</ul>
</li>
<li>
<p>Half building vignettes locally - see vignettes/README.md</p>
<ul>
<li><p>need phantomjs in your path on windows at least</p></li>
<li><p>see the comments in vignettes/build_some.R</p></li>
</ul>
</li>
<li>
<p>pkgdown locally</p>
<ul>
<li><p>pkgdown::build_articles() to see local changes to half-rendered
vignettes</p></li>
<li>
<p>You may want to run individual methods or <a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">pkgdown::build_site()</a>
which is a wrapper for</p>
<ul>
<li>init_site()</li>
<li>build_home()</li>
<li>build_reference()</li>
<li>build_articles()</li>
<li>build_tutorials()</li>
<li>build_news()</li>
<li>build_redirects() <br><br>
</li>
</ul>
</li>
</ul>
</li>
<li><p>build reference pages locally<br>
If you make changes to method documentation, run<br><code><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">devtools::document()</a></code><br><code><a href="https://pkgdown.r-lib.org/reference/build_reference.html" class="external-link">pkgdown::build_reference()</a></code></p></li>
<li><p>To see README.Rmd changes locally, from the Makefile</p></li>
</ul>
<pre><code><span><span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span><span class="st">'README.Rmd'</span>, output_file <span class="op">=</span> <span class="st">'README.md'</span>, output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, output_format <span class="op">=</span> <span class="st">'github_document'</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">'README.html'</span><span class="op">)</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_home.html" class="external-link">build_home</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<ul>
<li><p>Run code coverage locally on the whole package:
<code><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">devtools::test_coverage()</a></code> or
<code>devtools::test_coverage(function_exclusions = "\\.onLoad")</code>
or on an individual file:
<code>devtools::test_coverage_active_file(file = "R/print.R")</code>
You’d need to have covr installed</p></li>
<li><p>I needed to set an environmental variable
<code>CHROMOTE_HEADLESS=new</code><br><a href="https://github.com/rstudio/chromote/issues/187#issuecomment-2596286873" class="external-link">From</a>
&gt; Note that with chromote 0.3.1, you can opt into using the new
headless mode by setting Needed when this showed up in Rmd files<br>
#&gt; Old Headless mode has been removed from the Chrome binary. Please
use the new Headless mode (<a href="https://developer.chrome.com/docs/chromium/new-headless" class="external-link uri">https://developer.chrome.com/docs/chromium/new-headless</a>)
or the chrome-headless-shell which is a standalone implementation of the
old Headless mode (<a href="https://developer.chrome.com/blog/chrome-headless-shell" class="external-link uri">https://developer.chrome.com/blog/chrome-headless-shell</a>).</p></li>
</ul>
</li>
</ul>
<p><br><br> * Remotely</p>
<ul>
<li><p>pkgdown remotely<br>
You can set up github pages in your repo to display vignettes and man
pages, e.g. <a href="https://github.com/mustberuss/patentsview" class="external-link uri">https://github.com/mustberuss/patentsview</a></p></li>
<li><p>Remote Testing<br>
You can put your API key in your repo as a Repository secret so the
tests will run when you push changes. E.g., I have PATENTSVIEW_API_KEY
set in <a href="https://github.com/mustberuss/patentsview/settings/secrets/actions" class="external-link uri">https://github.com/mustberuss/patentsview/settings/secrets/actions</a>
(though settings aren’t publicly viewable)</p></li>
<li>
<p>Before doing a push</p>
<ul>
<li><p>make sure you are following the <a href="https://style.tidyverse.org/" class="external-link">Tidyverse style guide</a>. There are
plugins to keep you stylish
<code>styler::style_pkg(".", dry = "fail")</code> or
<code>styler::style_file('path/file')</code> if necessary or use a
plugin etc</p></li>
<li><p>make sure the examples still run
<code>devtools::run_examples(run_dontrun = TRUE)</code></p></li>
<li><p>check spelling using
<code>devtools::spell_check(pkg = ".", vignettes = TRUE, use_wordlist = TRUE)</code>
Locally I have an unchecked in inst/WORDLIST with additional words to
allow (one word per line) see <a href="https://devtools.r-lib.org/reference/spell_check.html" class="external-link uri">https://devtools.r-lib.org/reference/spell_check.html</a></p></li>
</ul>
</li>
<li>
<p>Optional</p>
<ul>
<li>you can set up your own r-universe by creating a special github
repo, as explained <a href="https://ropensci.org/blog/2021/06/22/setup-runiverse/" class="external-link">here</a>.
E.g., <a href="https://github.com/mustberuss/mustberuss.r-universe.dev" class="external-link uri">https://github.com/mustberuss/mustberuss.r-universe.dev</a>
with <a href="https://github.com/mustberuss/mustberuss.r-universe.dev/blob/master/packages.json" class="external-link uri">https://github.com/mustberuss/mustberuss.r-universe.dev/blob/master/packages.json</a>
See <a href="https://ropensci.org/blog/2023/02/07/runiverse-registry-repo/" class="external-link">this
article</a> on the newer repo naming convention <br><br>
</li>
</ul>
</li>
<li>
<p>Notes</p>
<ul>
<li>It’s a good idea to review the action logs, even on successful
builds. There can be warnings about long lines etc.</li>
<li>By default, patentsview is on r-universe <a href="https://ropensci.r-universe.dev/patentsview" class="external-link uri">https://ropensci.r-universe.dev/patentsview</a>
</li>
<li>Someone really smart should write a python library for the API!
<br><br>
</li>
</ul>
</li>
<li>
<p>Questions:</p>
<ul>
<li><p>Is there a way to set up notifications on r-universe build
failures? If you miss a skip_on_cran(), tests could work in your repo
(if you have your API key as a repo secret) but the build will silently
fail on r-universe. Don’t ask how I know that.</p></li>
<li>
<p>Why don’t the vignettes show up on r-universe? The articles link
is grayed out.</p>
<p>Ah, on the build it shows Build pkgdown site (ropensci only) was
skipped</p>
</li>
<li><p>Should we add a row_limit or something? We’d page our way and
stop when the row_limit is met. For someone wanting more than a 1000
rows but not necessarily all the rows, especially since there isn’t the
100,000 row limitation now. The API’s <code>after</code> is now exposed
in search_pv() so users could do their own paging. See the new <a href="result-set-paging.html">paging vignette</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="odd-demo">Odd Demo<a class="anchor" aria-label="anchor" href="#odd-demo"></a>
</h2>
<p>Here we demonstrate a weird interaction between the API and R package
when no sort parmeter is specified.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"patent_id"</span>, <span class="st">"patent_date"</span>, <span class="st">"patent_title"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span></span>
<span>  query <span class="op">=</span> <span class="st">'{"_gte":{"patent_date":"2007-01-01"}}'</span>,</span>
<span>  endpoint <span class="op">=</span> <span class="st">"patent"</span>, fields <span class="op">=</span> <span class="va">fields</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $data</span></span>
<span><span class="co">## #### A list with a single data frame on patents level:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## List of 1</span></span>
<span><span class="co">##  $ patents:'data.frame': 1000 obs. of  3 variables:</span></span>
<span><span class="co">##   ..$ patent_id   : chr [1:1000] "10045335" ...</span></span>
<span><span class="co">##   ..$ patent_title: chr [1:1000] "Method of delivering data for use by base s"..</span></span>
<span><span class="co">##   ..$ patent_date : chr [1:1000] "2018-08-07" ...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $query_results</span></span>
<span><span class="co">## #### Distinct entity counts across all downloadable pages of output:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## total_hits = 5,530,246</span></span></code></pre>
<p>Note that the first patent_date returned above is “2020-04-21” and
that what gets sent to the API is <code>&amp;s=[]&amp;o=</code> shown in
the output of the next section</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/last_response.html" class="external-link">last_request</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">url</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/URLencode.html" class="external-link">URLdecode</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## https://search.patentsview.org/api/v1/patent/?q={"_gte":{"patent_date":"2007-01-01"}}&amp;f=["patent_date","patent_id","patent_title"]&amp;s=[]&amp;o={"size":1000}</span></span></code></pre>
<p>Now we’ll send in our own GET with <code>&amp;s=&amp;o</code> to see
that the API return is different, seemingly applying a default sort?</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org" class="external-link">httr2</a></span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span><span class="st">"&amp;s=\\[\\]"</span>, <span class="st">"&amp;s="</span>, <span class="va">url</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/URLencode.html" class="external-link">URLdecode</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## https://search.patentsview.org/api/v1/patent/?q={"_gte":{"patent_date":"2007-01-01"}}&amp;f=["patent_date","patent_id","patent_title"]&amp;s=&amp;o={"size":1000}</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">api_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"PATENTSVIEW_API_KEY"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">req</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">request</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_method.html" class="external-link">req_method</a></span><span class="op">(</span><span class="st">"GET"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">resp</span> <span class="op">&lt;-</span> <span class="va">req</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_user_agent.html" class="external-link">req_user_agent</a></span><span class="op">(</span><span class="st">"https://github.com/ropensci/patentsview"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_retry.html" class="external-link">req_retry</a></span><span class="op">(</span>max_tries <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># automatic 429 Retry-After</span></span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_headers.html" class="external-link">req_headers</a></span><span class="op">(</span><span class="st">"X-Api-Key"</span> <span class="op">=</span> <span class="va">api_key</span>, .redact <span class="op">=</span> <span class="st">"X-Api-Key"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">json</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/last_response.html" class="external-link">last_response</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">json</span><span class="op">$</span><span class="va">patents</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $patent_id</span></span>
<span><span class="co">## [1] "10000000"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $patent_title</span></span>
<span><span class="co">## [1] "Coherent LADAR using intra-pixel quadrature detection"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $patent_date</span></span>
<span><span class="co">## [1] "2018-06-19"</span></span></code></pre>
<p>For a while POSTs and GETs behaved differently when a sort wasn’t
specified. Currently an API bug prevents seeing what the behavior is on
POSTS.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Christopher Baker, Russ Allen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
