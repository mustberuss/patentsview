<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Top assignees • patentsview</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/united/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Top assignees">
<meta property="og:description" content="patentsview">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">patentsview</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">
    <span class="fas fa-play"></span>
     
    Getting started
  </a>
</li>
<li>
  <a href="../articles/writing-queries.html">
    <span class="fas fa-pencil"></span>
     
    Writing queries
  </a>
</li>
<li>
  <a href="../articles/examples.html">
    <span class="fas fa-code"></span>
     
    Examples
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-bar-chart"></span>
     
    Applications
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/top-assignees.html">
        <span class="fas fa-university"></span>
         
        Top assignees
      </a>
    </li>
    <li>
      <a href="../articles/citation-networks.html">
        <span class="fas fa-long-arrow-left"></span>
         
        Citation networks
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fas fa-info-circle"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/patentsview">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="top-assignees_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Top assignees</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/patentsview/blob/master/vignettes/top-assignees.Rmd"><code>vignettes/top-assignees.Rmd</code></a></small>
      <div class="hidden name"><code>top-assignees.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>Note about the affect of the api change</p>
<p>This would be a good example of life under the new api, where we have
to make more than one call to get the same data as before. Maybe even
keep the old page around for comparison? If only I could manipulate
dataframes!</p>
<p>Intention (partially implemented): application date or year isn’t
available from any of the new version of the api’s endpoints. Instead
we’ll use patent_year (the year the patent was granted, already of type
integer). Trouble is that it’s at the patent level, not inside the
nested assignees_at_grant. Lacking the skill to get it there.</p>
<p>Remove the hacked Total number of patents and add assignee_id to the
top_asgns data frame, make a call to the assignee endpoint to get
num_patents (total number of patents) for the top 75 assignees, then if
it’s not too unRish, remove the assignee_id column and add the total
number of patents column and calculate the percentage (or create a new
data frame with the columns we want in the datatable). Then life, and
the script, goes on as normal (as the old one did).</p>
</blockquote>
<p>The following is a quick analysis of the top organizations patenting
in the field of databases.</p>
<ol style="list-style-type: decimal">
<li>The first step is to download the relevant data fields from the
PatentsView API:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/patentsview/index.html">patentsview</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://jkunst.com/highcharter">highcharter</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.name/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org">stringr</a></span><span class="op">)</span>

<span class="co"># With the recent api change that limits the overall result set size, we now look</span>
<span class="co"># for databases (plural) where we used to use the singular database for this example.</span>
<span class="co"># We also exclude patents without an assignee organization.</span>

<span class="co"># We first need to write a query. Our query will look for "databases" in either </span>
<span class="co"># the patent title or abstract...Note, this isn't a terribly good way to ID our </span>
<span class="co"># patents, but it will work for the purpose of demonstration. Users who are </span>
<span class="co"># interested in writing higher-quality queries could consult the large body of </span>
<span class="co"># research that has been done in field of patent document retrieval.</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/with_qfuns.html">with_qfuns</a></span><span class="op">(</span>
  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">and</a></span><span class="op">(</span>
     <span class="fu">neq</span><span class="op">(</span><span class="st">"assignees_at_grant.organization"</span> <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,
     <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">or</a></span><span class="op">(</span>
       <span class="fu">text_phrase</span><span class="op">(</span>patent_abstract <span class="op">=</span> <span class="st">"databases"</span><span class="op">)</span>,
       <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span>patent_title <span class="op">=</span> <span class="st">"databases"</span><span class="op">)</span>
     <span class="op">)</span>
   <span class="op">)</span>
<span class="op">)</span>

<span class="va">query</span>
<span class="co">#&gt; {"_and":[{"_neq":{"assignees_at_grant.organization":""}},{"_or":[{"_text_phrase":{"patent_abstract":"databases"}},{"_contains":{"patent_title":"databases"}}]}]}</span>

<span class="co"># Create a list of the fields we'll need for the analysis</span>
<span class="co"># using assignee's type since we can't get assignee_total_num_patents from </span>
<span class="co"># the patent endpoint</span>

<span class="va">fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"patent_number"</span>, <span class="st">"patent_date"</span>,<span class="st">"patent_year"</span>,
  <span class="st">"assignees_at_grant.type"</span>,  <span class="co"># hack since we don't get the total number of patents by assignee from the endpoint now</span>
  <span class="st">"assignees_at_grant.organization"</span>,  <span class="co"># full text field now if used in q:</span>
  <span class="st">"assignees_at_grant.assignee_id"</span>  <span class="co"># this comes back as "assignees_at_grant.assignee</span>
<span class="op">)</span>

<span class="co"># Send an HTTP request to the PatentsView API to get the data</span>
<span class="va">pv_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">query</span>, fields <span class="op">=</span> <span class="va">fields</span>, all_pages <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Error: assignees_at_grant.organization is not a valid field to query for your endpoint</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Now let’s identify who the top assignees are based on how many
patents they have in our data set. We’ll also calculate how many total
patents these assignees have and what fraction of their total patents
relate to databases.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Unnest the data frames that are stored in the assignee list column</span>
<span class="va">dl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_pv_data.html">unnest_pv_data</a></span><span class="op">(</span><span class="va">pv_out</span><span class="op">$</span><span class="va">data</span>, <span class="st">"patent_number"</span><span class="op">)</span>
<span class="va">dl</span>
<span class="co">#&gt; List of 18</span>
<span class="co">#&gt;  $ inventors            :'data.frame':   4 obs. of  24 variables:</span>
<span class="co">#&gt;   ..$ patent_number                 : chr [1:4] "5116621" ...</span>
<span class="co">#&gt;   ..$ inventor_city                 : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_country              : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_county               : logi [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_county_fips          : logi [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_first_name           : chr [1:4] "Akihito" ...</span>
<span class="co">#&gt;   ..$ inventor_first_seen_date      : chr [1:4] "1992-01-21" ...</span>
<span class="co">#&gt;   ..$ inventor_id                   : chr [1:4] "fl:ak_ln:oji-1" ...</span>
<span class="co">#&gt;   ..$ inventor_last_name            : chr [1:4] "Oji" ...</span>
<span class="co">#&gt;   ..$ inventor_last_seen_date       : chr [1:4] "1992-05-26" ...</span>
<span class="co">#&gt;   ..$ inventor_lastknown_city       : chr [1:4] "Ohkawa" ...</span>
<span class="co">#&gt;   ..$ inventor_lastknown_country    : chr [1:4] "JP" ...</span>
<span class="co">#&gt;   ..$ inventor_lastknown_latitude   : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_lastknown_location_id: chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_lastknown_longitude  : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_lastknown_state      : logi [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_latitude             : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_location_id          : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_longitude            : chr [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_sequence             : chr [1:4] "0" ...</span>
<span class="co">#&gt;   ..$ inventor_state                : logi [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_state_fips           : logi [1:4] NA ...</span>
<span class="co">#&gt;   ..$ inventor_total_num_patents    : chr [1:4] "2" ...</span>
<span class="co">#&gt;   ..$ inventor_key_id               : chr [1:4] "1898331" ...</span>
<span class="co">#&gt;  $ rawinventors         :'data.frame':   4 obs. of  3 variables:</span>
<span class="co">#&gt;   ..$ patent_number         : chr [1:4] "5116621" ...</span>
<span class="co">#&gt;   ..$ rawinventor_first_name: chr [1:4] "Akihito" ...</span>
<span class="co">#&gt;   ..$ rawinventor_last_name : chr [1:4] "Oji" ...</span>
<span class="co">#&gt;  $ assignees            :'data.frame':   2 obs. of  27 variables:</span>
<span class="co">#&gt;   ..$ patent_number                 : chr [1:2] "5116621" ...</span>
<span class="co">#&gt;   ..$ assignee_city                 : chr [1:2] "Kagawa" ...</span>
<span class="co">#&gt;   ..$ assignee_country              : chr [1:2] "JP" ...</span>
<span class="co">#&gt;   ..$ assignee_county               : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_county_fips          : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_first_name           : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_first_seen_date      : chr [1:2] "1986-06-10" ...</span>
<span class="co">#&gt;   ..$ assignee_id                   : chr [1:2] "f074e68e-78a0-449d-83cd-eb05"..</span>
<span class="co">#&gt;   ..$ assignee_last_name            : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_last_seen_date       : chr [1:2] "2021-11-23" ...</span>
<span class="co">#&gt;   ..$ assignee_lastknown_city       : chr [1:2] "Kagawa" ...</span>
<span class="co">#&gt;   ..$ assignee_lastknown_country    : chr [1:2] "JP" ...</span>
<span class="co">#&gt;   ..$ assignee_lastknown_latitude   : chr [1:2] "35.3562" ...</span>
<span class="co">#&gt;   ..$ assignee_lastknown_location_id: chr [1:2] "35.3562|139.4" ...</span>
<span class="co">#&gt;   ..$ assignee_lastknown_longitude  : chr [1:2] "139.4" ...</span>
<span class="co">#&gt;   ..$ assignee_lastknown_state      : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_latitude             : chr [1:2] "35.3562" ...</span>
<span class="co">#&gt;   ..$ assignee_location_id          : chr [1:2] "35.3562|139.4" ...</span>
<span class="co">#&gt;   ..$ assignee_longitude            : chr [1:2] "139.4" ...</span>
<span class="co">#&gt;   ..$ assignee_organization         : chr [1:2] "TEIKOKU SEIYAKU CO., LTD." ...</span>
<span class="co">#&gt;   ..$ assignee_sequence             : chr [1:2] "1" ...</span>
<span class="co">#&gt;   ..$ assignee_state                : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_state_fips           : logi [1:2] NA ...</span>
<span class="co">#&gt;   ..$ assignee_total_num_inventors  : chr [1:2] "148" ...</span>
<span class="co">#&gt;   ..$ assignee_total_num_patents    : chr [1:2] "110" ...</span>
<span class="co">#&gt;   ..$ assignee_type                 : chr [1:2] "3" ...</span>
<span class="co">#&gt;   ..$ assignee_key_id               : chr [1:2] "7505" ...</span>
<span class="co">#&gt;  $ applications         :'data.frame':   1 obs. of  6 variables:</span>
<span class="co">#&gt;   ..$ patent_number: chr "5116621"</span>
<span class="co">#&gt;   ..$ app_country  : chr "US"</span>
<span class="co">#&gt;   ..$ app_date     : chr "1990-12-24"</span>
<span class="co">#&gt;   ..$ app_number   : chr "07633146"</span>
<span class="co">#&gt;   ..$ app_type     : chr "07"</span>
<span class="co">#&gt;   ..$ app_id       : chr "07/633146"</span>
<span class="co">#&gt;  $ IPCs                 :'data.frame':   1 obs. of  16 variables:</span>
<span class="co">#&gt;   ..$ patent_number                 : chr "5116621"</span>
<span class="co">#&gt;   ..$ ipc_action_date               : logi NA</span>
<span class="co">#&gt;   ..$ ipc_class                     : chr "61"</span>
<span class="co">#&gt;   ..$ ipc_classification_data_source: logi NA</span>
<span class="co">#&gt;   ..$ ipc_classification_value      : logi NA</span>
<span class="co">#&gt;   ..$ ipc_first_seen_date           : chr "1976-01-06"</span>
<span class="co">#&gt;   ..$ ipc_last_seen_date            : chr "2021-12-28"</span>
<span class="co">#&gt;   ..$ ipc_main_group                : chr "13"</span>
<span class="co">#&gt;   ..$ ipc_section                   : chr "A"</span>
<span class="co">#&gt;   ..$ ipc_sequence                  : chr "0"</span>
<span class="co">#&gt;   ..$ ipc_subclass                  : chr "F"</span>
<span class="co">#&gt;   ..$ ipc_subgroup                  : chr "00"</span>
<span class="co">#&gt;   ..$ ipc_symbol_position           : logi NA</span>
<span class="co">#&gt;   ..$ ipc_total_num_assignees       : chr "13865"</span>
<span class="co">#&gt;   ..$ ipc_total_num_inventors       : chr "78409"</span>
<span class="co">#&gt;   ..$ ipc_version_indicator         : logi NA</span>
<span class="co">#&gt;  $ application_citations:'data.frame':   1 obs. of  6 variables:</span>
<span class="co">#&gt;   ..$ patent_number    : chr "5116621"</span>
<span class="co">#&gt;   ..$ appcit_app_number: logi NA</span>
<span class="co">#&gt;   ..$ appcit_category  : logi NA</span>
<span class="co">#&gt;   ..$ appcit_date      : logi NA</span>
<span class="co">#&gt;   ..$ appcit_kind      : logi NA</span>
<span class="co">#&gt;   ..$ appcit_sequence  : logi NA</span>
<span class="co">#&gt;  $ cited_patents        :'data.frame':   6 obs. of  7 variables:</span>
<span class="co">#&gt;   ..$ patent_number        : chr [1:6] "5116621" ...</span>
<span class="co">#&gt;   ..$ cited_patent_category: logi [1:6] NA ...</span>
<span class="co">#&gt;   ..$ cited_patent_date    : chr [1:6] "1977-02-15" ...</span>
<span class="co">#&gt;   ..$ cited_patent_kind    : chr [1:6] "A" ...</span>
<span class="co">#&gt;   ..$ cited_patent_number  : chr [1:6] "4008321" ...</span>
<span class="co">#&gt;   ..$ cited_patent_sequence: chr [1:6] "0" ...</span>
<span class="co">#&gt;   ..$ cited_patent_title   : chr [1:6] "Composition for a topical preparation"..</span>
<span class="co">#&gt;  $ citedby_patents      :'data.frame':   15 obs. of  6 variables:</span>
<span class="co">#&gt;   ..$ patent_number          : chr [1:15] "5116621" ...</span>
<span class="co">#&gt;   ..$ citedby_patent_category: chr [1:15] NA ...</span>
<span class="co">#&gt;   ..$ citedby_patent_date    : chr [1:15] "1995-04-25" ...</span>
<span class="co">#&gt;   ..$ citedby_patent_kind    : chr [1:15] "A" ...</span>
<span class="co">#&gt;   ..$ citedby_patent_number  : chr [1:15] "5409691" ...</span>
<span class="co">#&gt;   ..$ citedby_patent_title   : chr [1:15] "Solution comprising aluminum aceta"..</span>
<span class="co">#&gt;  $ uspcs                :'data.frame':   4 obs. of  11 variables:</span>
<span class="co">#&gt;   ..$ patent_number           : chr [1:4] "5116621" ...</span>
<span class="co">#&gt;   ..$ uspc_first_seen_date    : chr [1:4] "1976-01-06" ...</span>
<span class="co">#&gt;   ..$ uspc_last_seen_date     : chr [1:4] "2016-01-05" ...</span>
<span class="co">#&gt;   ..$ uspc_mainclass_id       : chr [1:4] "424" ...</span>
<span class="co">#&gt;   ..$ uspc_mainclass_title    : chr [1:4] "Drug, bio-affecting and body treat"..</span>
<span class="co">#&gt;   ..$ uspc_sequence           : chr [1:4] "0" ...</span>
<span class="co">#&gt;   ..$ uspc_subclass_id        : chr [1:4] "424/445" ...</span>
<span class="co">#&gt;   ..$ uspc_subclass_title     : chr [1:4] "Dressings" ...</span>
<span class="co">#&gt;   ..$ uspc_total_num_assignees: chr [1:4] "17103" ...</span>
<span class="co">#&gt;   ..$ uspc_total_num_inventors: chr [1:4] "120694" ...</span>
<span class="co">#&gt;   ..$ uspc_total_num_patents  : chr [1:4] "101671" ...</span>
<span class="co">#&gt;  $ cpcs                 :'data.frame':   6 obs. of  15 variables:</span>
<span class="co">#&gt;   ..$ patent_number          : chr [1:6] "5116621" ...</span>
<span class="co">#&gt;   ..$ cpc_category           : chr [1:6] "inventional" ...</span>
<span class="co">#&gt;   ..$ cpc_first_seen_date    : chr [1:6] "1976-01-06" ...</span>
<span class="co">#&gt;   ..$ cpc_group_id           : chr [1:6] "A61K" ...</span>
<span class="co">#&gt;   ..$ cpc_group_title        : chr [1:6] "Preparations for medical, dental, o"..</span>
<span class="co">#&gt;   ..$ cpc_last_seen_date     : chr [1:6] "2021-12-28" ...</span>
<span class="co">#&gt;   ..$ cpc_section_id         : chr [1:6] "A" ...</span>
<span class="co">#&gt;   ..$ cpc_sequence           : chr [1:6] "0" ...</span>
<span class="co">#&gt;   ..$ cpc_subgroup_id        : chr [1:6] "A61K9/7061" ...</span>
<span class="co">#&gt;   ..$ cpc_subgroup_title     : chr [1:6] "Medicinal preparations characterise"..</span>
<span class="co">#&gt;   ..$ cpc_subsection_id      : chr [1:6] "A61" ...</span>
<span class="co">#&gt;   ..$ cpc_subsection_title   : chr [1:6] "Medical or veterinary science; hygi"..</span>
<span class="co">#&gt;   ..$ cpc_total_num_assignees: chr [1:6] "79114" ...</span>
<span class="co">#&gt;   ..$ cpc_total_num_inventors: chr [1:6] "595860" ...</span>
<span class="co">#&gt;   ..$ cpc_total_num_patents  : chr [1:6] "782251" ...</span>
<span class="co">#&gt;  $ nbers                :'data.frame':   1 obs. of  10 variables:</span>
<span class="co">#&gt;   ..$ patent_number           : chr "5116621"</span>
<span class="co">#&gt;   ..$ nber_category_id        : chr "3"</span>
<span class="co">#&gt;   ..$ nber_category_title     : chr "Drgs&amp;Med"</span>
<span class="co">#&gt;   ..$ nber_first_seen_date    : chr "1976-01-06"</span>
<span class="co">#&gt;   ..$ nber_last_seen_date     : chr "2015-05-26"</span>
<span class="co">#&gt;   ..$ nber_subcategory_id     : chr "31"</span>
<span class="co">#&gt;   ..$ nber_subcategory_title  : chr "Drugs"</span>
<span class="co">#&gt;   ..$ nber_total_num_assignees: chr "28222"</span>
<span class="co">#&gt;   ..$ nber_total_num_inventors: chr "256340"</span>
<span class="co">#&gt;   ..$ nber_total_num_patents  : chr "266148"</span>
<span class="co">#&gt;  $ wipos                :'data.frame':   1 obs. of  5 variables:</span>
<span class="co">#&gt;   ..$ patent_number    : chr "5116621"</span>
<span class="co">#&gt;   ..$ wipo_field_id    : chr "16"</span>
<span class="co">#&gt;   ..$ wipo_field_title : chr "Pharmaceuticals"</span>
<span class="co">#&gt;   ..$ wipo_sector_title: chr "Chemistry"</span>
<span class="co">#&gt;   ..$ wipo_sequence    : chr "0"</span>
<span class="co">#&gt;  $ gov_interests        :'data.frame':   1 obs. of  8 variables:</span>
<span class="co">#&gt;   ..$ patent_number               : chr "5116621"</span>
<span class="co">#&gt;   ..$ govint_contract_award_number: logi NA</span>
<span class="co">#&gt;   ..$ govint_org_id               : logi NA</span>
<span class="co">#&gt;   ..$ govint_org_level_one        : logi NA</span>
<span class="co">#&gt;   ..$ govint_org_level_two        : logi NA</span>
<span class="co">#&gt;   ..$ govint_org_level_three      : logi NA</span>
<span class="co">#&gt;   ..$ govint_org_name             : logi NA</span>
<span class="co">#&gt;   ..$ govint_raw_statement        : logi NA</span>
<span class="co">#&gt;  $ lawyers              :'data.frame':   1 obs. of  11 variables:</span>
<span class="co">#&gt;   ..$ patent_number             : chr "5116621"</span>
<span class="co">#&gt;   ..$ lawyer_first_name         : logi NA</span>
<span class="co">#&gt;   ..$ lawyer_first_seen_date    : chr "1990-11-13"</span>
<span class="co">#&gt;   ..$ lawyer_id                 : chr "da90021e775d9db35e62d10ff29da2ea"</span>
<span class="co">#&gt;   ..$ lawyer_last_name          : logi NA</span>
<span class="co">#&gt;   ..$ lawyer_last_seen_date     : chr "1995-12-26"</span>
<span class="co">#&gt;   ..$ lawyer_organization       : chr "Wegner, Cantor, Mueller &amp; Player"</span>
<span class="co">#&gt;   ..$ lawyer_sequence           : chr "0"</span>
<span class="co">#&gt;   ..$ lawyer_total_num_assignees: chr "385"</span>
<span class="co">#&gt;   ..$ lawyer_total_num_inventors: chr "1915"</span>
<span class="co">#&gt;   ..$ lawyer_total_num_patents  : chr "1116"</span>
<span class="co">#&gt;  $ examiners            :'data.frame':   2 obs. of  6 variables:</span>
<span class="co">#&gt;   ..$ patent_number      : chr [1:2] "5116621" ...</span>
<span class="co">#&gt;   ..$ examiner_first_name: chr [1:2] "Leon R." ...</span>
<span class="co">#&gt;   ..$ examiner_id        : chr [1:2] "1j5f94rt56e3fgpdbdqnuwo74" ...</span>
<span class="co">#&gt;   ..$ examiner_last_name : chr [1:2] "Horne" ...</span>
<span class="co">#&gt;   ..$ examiner_role      : chr [1:2] "assistant" ...</span>
<span class="co">#&gt;   ..$ examiner_group     : logi [1:2] NA ...</span>
<span class="co">#&gt;  $ foreign_priority     :'data.frame':   1 obs. of  6 variables:</span>
<span class="co">#&gt;   ..$ patent_number     : chr "5116621"</span>
<span class="co">#&gt;   ..$ forprior_country  : chr "JP"</span>
<span class="co">#&gt;   ..$ forprior_date     : chr "1989-12-25"</span>
<span class="co">#&gt;   ..$ forprior_docnumber: chr "1-332599"</span>
<span class="co">#&gt;   ..$ forprior_kind     : logi NA</span>
<span class="co">#&gt;   ..$ forprior_sequence : chr "0"</span>
<span class="co">#&gt;  $ pct_data             :'data.frame':   1 obs. of  7 variables:</span>
<span class="co">#&gt;   ..$ patent_number: chr "5116621"</span>
<span class="co">#&gt;   ..$ pct_102_date : logi NA</span>
<span class="co">#&gt;   ..$ pct_371_date : logi NA</span>
<span class="co">#&gt;   ..$ pct_date     : logi NA</span>
<span class="co">#&gt;   ..$ pct_docnumber: logi NA</span>
<span class="co">#&gt;   ..$ pct_doctype  : logi NA</span>
<span class="co">#&gt;   ..$ pct_kind     : logi NA</span>
<span class="co">#&gt;  $ patents              :'data.frame':   1 obs. of  30 variables:</span>
<span class="co">#&gt;   ..$ patent_number                         : chr "5116621"</span>
<span class="co">#&gt;   ..$ detail_desc_length                    : chr "11598"</span>
<span class="co">#&gt;   ..$ patent_abstract                       : chr "An anti-inflammatory analg"..</span>
<span class="co">#&gt;   ..$ patent_average_processing_time        : logi NA</span>
<span class="co">#&gt;   ..$ patent_date                           : chr "1992-05-26"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_city       : chr "Tokyo"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_country    : chr "JP"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_id         : chr "73fe03d7-2cd7-4236-b044-ef"..</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_latitude   : chr "34.2256"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_location_id: chr "34.2256|139.295"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_longitude  : chr "139.295"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_assignee_state      : logi NA</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_city       : chr "Ohkawa"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_country    : chr "JP"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_id         : chr "fl:ak_ln:oji-1"</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_latitude   : logi NA</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_location_id: logi NA</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_longitude  : logi NA</span>
<span class="co">#&gt;   ..$ patent_firstnamed_inventor_state      : logi NA</span>
<span class="co">#&gt;   ..$ patent_kind                           : chr "A"</span>
<span class="co">#&gt;   ..$ patent_num_cited_by_us_patents        : chr "15"</span>
<span class="co">#&gt;   ..$ patent_num_claims                     : chr "9"</span>
<span class="co">#&gt;   ..$ patent_num_combined_citations         : chr "9"</span>
<span class="co">#&gt;   ..$ patent_num_foreign_citations          : chr "3"</span>
<span class="co">#&gt;   ..$ patent_num_us_application_citations   : chr "0"</span>
<span class="co">#&gt;   ..$ patent_num_us_patent_citations        : chr "6"</span>
<span class="co">#&gt;   ..$ patent_processing_time                : logi NA</span>
<span class="co">#&gt;   ..$ patent_title                          : chr "Anti-inflammatory analgesi"..</span>
<span class="co">#&gt;   ..$ patent_type                           : chr "utility"</span>
<span class="co">#&gt;   ..$ patent_year                           : chr "1992"</span>

<span class="co"># we shouldn't need the filter (we queried for non empty string orginazations) but</span>
<span class="co"># some are NA somehow</span>

<span class="co"># we don't get the assignee_total_num_patents back from the patents endpoint</span>
<span class="co"># can we calculate it ourselves? using the assignees_at_grant type for the code to work (HACK)</span>

<span class="co"># get the assignee_ids for the top 75 assignees - we'll call the assignee endpoint with them</span>
<span class="co"># to get the total number of patents</span>

<span class="co"># requested assignees_at_grant.assignee_id comes back in the assignees_at_grant object </span>
<span class="co"># with key "assignee" and value of https://search.patentsview.org/api/v1/assignee/35/</span>
<span class="co"># we want to parse out the assignee_ids (35 in the example value)</span>
<span class="co"># str_extract(assignee, "(\\d+)(?=/$)")</span>

<span class="co"># would really not want ttl_pats and division yet but we'll leave it for now</span>

<span class="co"># Create a data frame with the top 75 assignees:</span>
<span class="va">top_asgns</span> <span class="op">&lt;-</span>
  <span class="va">dl</span><span class="op">$</span><span class="va">assignees_at_grant</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">organization</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># some patents are assigned to an inventor (not an org)</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ttl_pats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>assignee_id <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">assignee</span>, <span class="st">"(\\d+)(?=/$)"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">organization</span>, <span class="va">ttl_pats</span>, <span class="va">assignee_id</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>db_pats <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>frac_db_pats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">db_pats</span> <span class="op">/</span> <span class="va">ttl_pats</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">db_pats</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">75</span><span class="op">)</span>
<span class="co">#&gt; Error in UseMethod("filter"): no applicable method for 'filter' applied to an object of class "NULL"</span>

<span class="co"># now that we have the assignee_id's we can call the assignee endpoint to get the</span>
<span class="co"># total number of patents for each of our top_asgns </span>

<span class="co"># in this case it might be nice to have a qry_funs$in for the api's array eq</span>
<span class="co"># thinking the api might not like 75 or'ed conditions (thought it did work when I tried it)</span>
<span class="co">#assignee_query =  qry_funs$eq(assignee_id = as.integer(top_asgns$assignee_id))</span>
<span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/toString.html">toString</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">top_asgns</span><span class="op">$</span><span class="va">assignee_id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in toString(as.integer(top_asgns$assignee_id)): object 'top_asgns' not found</span>
<span class="va">assignee_query</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">'{"assignee_id":['</span>,<span class="va">s</span>,<span class="st">']}'</span><span class="op">)</span>
<span class="co">#&gt; Error in paste("{\"assignee_id\":[", s, "]}"): object 's' not found</span>

<span class="va">assignee_fields</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"assignee_id"</span>,<span class="st">"organization"</span>, <span class="st">"num_patents"</span> 
<span class="op">)</span>

<span class="co"># we'll post to the api, the query is pretty large if we use qry_funs$eq</span>
<span class="va">assignee_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_pv.html">search_pv</a></span><span class="op">(</span><span class="va">assignee_query</span> , fields <span class="op">=</span> <span class="va">assignee_fields</span>, all_pages <span class="op">=</span> <span class="cn">TRUE</span>, 
   endpoint <span class="op">=</span> <span class="st">"assignees"</span>, method <span class="op">=</span> <span class="st">"POST"</span><span class="op">)</span>
<span class="co">#&gt; Error in search_pv(assignee_query, fields = assignee_fields, all_pages = TRUE, : object 'assignee_query' not found</span>

<span class="co"># TODO:</span>
<span class="co"># now we'd want to mutate in the total counts and do the percentage math in top_asgns </span>
<span class="co"># some type of join exceeding my capabilities!</span>

<span class="co"># remove assignee_id column</span>
<span class="va">top_asgns</span> <span class="op">&lt;-</span>  <span class="va">top_asgns</span>  <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span> <span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">assignee_id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in select(., -c(assignee_id)): object 'top_asgns' not found</span>

<span class="co"># Create datatable</span>
<span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">top_asgns</span>,
  rownames <span class="op">=</span> <span class="cn">FALSE</span>,
  colnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="st">"Assignee"</span>, <span class="st">"DB patents"</span>,<span class="st">"Total patents"</span>, <span class="st">"DB patents / total patents"</span>
  <span class="op">)</span>,
  caption <span class="op">=</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">tags</a></span><span class="op">$</span><span class="fu">caption</span><span class="op">(</span>
    style <span class="op">=</span> <span class="st">'caption-side: top; text-align: left; font-style: italic;'</span>,
    <span class="st">"Table 1: Top assignees in 'databases'"</span>
  <span class="op">)</span>,
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>pageLength <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; Error in crosstalk::is.SharedData(data): object 'top_asgns' not found</span></code></pre></div>
<p><br></p>
<p>IBM is far and away the biggest player in the field. However, we can
see that Oracle and Salesforce.com are relatively more interested in
this area, as indicated by the fraction of their patents that relate to
databases.</p>
<ol start="3" style="list-style-type: decimal">
<li>Let’s see how these assignees’ level of investment in databases has
changed over time.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># The patent endpoint no longer returns application date as this page used originally</span>
<span class="co"># Instead we will use the patent_year</span>
<span class="co"># Alarmingly the application date is not available from any endpoint!</span>

<span class="co"># don't know enough R to do this properly!</span>
<span class="co"># would really only want to return the patent year if the </span>

<span class="va">with_grant_years</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">pv_out</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">patents</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">grant_year</span> <span class="op">=</span> <span class="va">y</span><span class="op">$</span><span class="va">patent_year</span>
   <span class="va">abc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">assignees_at_grant</span>, <span class="kw">function</span><span class="op">(</span><span class="va">z</span>,<span class="va">i</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">abc</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">abc</span>, <span class="va">grant_year</span><span class="op">)</span>
      <span class="va">z</span>
      <span class="op">}</span>, <span class="va">y</span><span class="op">$</span><span class="va">assignees_at_grant</span><span class="op">)</span>
   <span class="va">y</span><span class="op">$</span><span class="va">assignees_at_grant</span><span class="op">$</span><span class="va">grant_year</span> <span class="op">=</span> <span class="va">abc</span>
   <span class="va">y</span>
<span class="op">}</span>, y<span class="op">=</span><span class="va">pv_out</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">patents</span><span class="op">)</span>


<span class="co"># trouble is that this is the years for all assignees, not just the top 75</span>
<span class="co"># probably need to iterate through top_asgns to figure this out or to </span>
<span class="co"># have something we can join to below</span>

<span class="co"># wanting to add grant_year to assignees_at_grant but it's failing</span>
<span class="co">##pv_out$data$patents$assignees_at_grant$grant_year &lt;- NA</span>
<span class="co">##pv_out$data$patents$assignees_at_grant$grant_year &lt;- grant_years$patent_year</span>
<span class="co"># replacement has 6599 rows, data has 6598</span>

<span class="co"># Create a data frame with patent counts by grant year for each assignee</span>

<span class="va">data</span> <span class="op">&lt;-</span> 
  <span class="va">top_asgns</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"pats"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">dl</span><span class="op">$</span><span class="va">assignees_at_grant</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="co"># inner_join(dl$applications) %&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>grant_yr <span class="op">=</span> <span class="va">dl</span><span class="op">$</span><span class="va">assignees_at_grant</span><span class="op">$</span><span class="va">grant_year</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">dl</span><span class="op">$</span><span class="va">assignees_at_grant.organization</span>, <span class="va">grant_yr</span><span class="op">)</span> <span class="op">%&gt;%</span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> 
<span class="co">#&gt; Error in select(., -contains("pats")): object 'top_asgns' not found</span>



<span class="co"># Plot the data using highchartr:</span>
<span class="fu"><a href="https://jkunst.com/highcharter/reference/hchart.html">hchart</a></span><span class="op">(</span>
  <span class="va">data</span>, <span class="st">"line"</span>, 
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hcaes.html">hcaes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grant_yr</span>, y <span class="op">=</span> <span class="va">n</span>, group <span class="op">=</span> <span class="va">assignee_organization</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_plotOptions.html">hc_plotOptions</a></span><span class="op">(</span>series <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>marker <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_xAxis.html">hc_xAxis</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Grant year"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_yAxis.html">hc_yAxis</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Patents"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_title.html">hc_title</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Top five assignees in 'databases'"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_subtitle.html">hc_subtitle</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Yearly granted patents over time"</span><span class="op">)</span>
<span class="co">#&gt; Error: Objects of class/type function are not supported by hchart (yet).</span></code></pre></div>
<p>It’s hard to see any clear trends in this graph. What is clear is
that the top assignees have all been patenting in the field for many
years.</p>
<ol start="4" style="list-style-type: decimal">
<li>Finally, let’s see how the organizations compare in terms of their
citation rates. First, we’ll need to normalize the raw citation counts
by publication year, so that older patents don’t have an unfair
advantage over younger patents (i.e., because they have had a longer
time to accumulate citations).</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Write a ranking function that will be used to rank patents by their citation counts</span>
<span class="va">percent_rank2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">x</span>, ties.method <span class="op">=</span> <span class="st">"average"</span>, na.last <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># Create a data frame with normalized citation rates and stats from Step 2</span>
<span class="va">asng_p_dat</span> <span class="op">&lt;-</span>
  <span class="va">dl</span><span class="op">$</span><span class="va">patents</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>patent_yr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">patent_date</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">patent_yr</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>perc_cite <span class="op">=</span> <span class="fu">percent_rank2</span><span class="op">(</span><span class="va">patent_num_cited_by_us_patents</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">dl</span><span class="op">$</span><span class="va">assignees</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">assignee_organization</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>mean_perc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">perc_cite</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">top_asgns</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">ttl_pats</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">assignee_organization</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#f1c40f"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in is.data.frame(y): object 'top_asgns' not found</span>

<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">asng_p_dat</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in head(asng_p_dat): object 'asng_p_dat' not found</span></code></pre></div>
<p>Now let’s visualize the data. Each assignee will be represented by a
point/bubble. The x-value of the point will represent the total number
of patents the assignee has published in the field of databases (on a
log scale), while the y-value will represent its average normalized
citation rate. The size of the bubble will be proportional to the
percent of the assignee’s patents that relate to databases.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Adapted from http://jkunst.com/highcharter/showcase.html</span>
<span class="fu"><a href="https://jkunst.com/highcharter/reference/hchart.html">hchart</a></span><span class="op">(</span>
  <span class="va">asng_p_dat</span>, <span class="st">"scatter"</span>, 
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hcaes.html">hcaes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">db_pats</span>, y <span class="op">=</span> <span class="va">mean_perc</span>, size <span class="op">=</span> <span class="va">frac_db_pats</span>, 
        group <span class="op">=</span> <span class="va">assignee_organization</span>, color <span class="op">=</span> <span class="va">color</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_xAxis.html">hc_xAxis</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"DB patents"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"logarithmic"</span>,
    allowDecimals <span class="op">=</span> <span class="cn">FALSE</span>, endOnTick <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_yAxis.html">hc_yAxis</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Mean cite perc."</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_title.html">hc_title</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Top assignees in 'databases'"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_add_theme.html">hc_add_theme</a></span><span class="op">(</span><span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_theme_flatdark.html">hc_theme_flatdark</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_tooltip.html">hc_tooltip</a></span><span class="op">(</span>
    useHTML <span class="op">=</span> <span class="cn">TRUE</span>, pointFormat <span class="op">=</span> <span class="fu"><a href="https://jkunst.com/highcharter/reference/tooltip_table.html">tooltip_table</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DB patents"</span>, <span class="st">"Mean cite percentile"</span>, <span class="st">"Fraction DB patents"</span><span class="op">)</span>,
    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"{point.db_pats:.0f}"</span>,<span class="st">"{point.mean_perc:.2f}"</span>, <span class="st">"{point.frac_db_pats:.3f}"</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://jkunst.com/highcharter/reference/hc_legend.html">hc_legend</a></span><span class="op">(</span>enabled <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in hchart(asng_p_dat, "scatter", hcaes(x = db_pats, y = mean_perc, : object 'asng_p_dat' not found</span></code></pre></div>
<p><br></p>
<p>It looks like Microsoft has relatively high values across all three
three metrics (average citation percentile, number of database patents,
and percent of total patents that are related to databases). IBM has
more patents than Microsoft, but also has a lower average citation
percentile.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Christopher Baker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
