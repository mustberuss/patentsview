---
title: "Examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



## Recent API Change

With the recent api change, the patent endpoint is the main way to retrieve data. The other 
endpoints supply additional information.

## Patents endpoint

Which patents have been cited by more than 500 US patents?


```r
library(patentsview)

search_pv(query = qry_funs$gt(patent_num_times_cited_by_us_patents = 500))
#> $data
#> [1] "patents"
#> #### A list with a single data frame (with list column(s) inside) on a patent level:
#> 
#> List of 1
#>  $ patents:'data.frame':	25 obs. of  5 variables:
#>   ..$ patent_number     : chr [1:25] "4278837" ...
#>   ..$ patent_title      : chr [1:25] "Crypto microprocessor for executing enc"..
#>   ..$ patent_date       : chr [1:25] "1981-07-14" ...
#>   ..$ inventors_at_grant:List of 25
#>   ..$ assignees_at_grant:List of 25
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 9,108
```

How many distinct inventors are represented by these highly-cited patents?


```r
# Setting subent_cnts = TRUE will give us the subentity counts. Since inventors 
# are subentities for the patents endpoint, this means we will get their counts.
search_pv(
  query = qry_funs$gt(patent_num_times_cited_by_us_patents = 500),
  fields = c("patent_number", "inventors_at_grant.inventor"), 
  subent_cnts = TRUE
)
#> [1] "The api's requests per minute limit has been reached.  Pausing for 2 seconds before continuing."
#> Warning in one_request(method, query, base_url, arg_list, ...): The api's
#> requests per minute limit has been reached. Pausing for 2 seconds before
#> continuing.
#> $data
#> [1] "patents"
#> #### A list with a single data frame on a patent level:
#> 
#> List of 1
#>  $ patents:'data.frame':	25 obs. of  1 variable:
#>   ..$ patent_number: chr [1:25] "4278837" ...
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 9,108
```

Where geographically have Microsoft inventors been coming from over the past few years?


```r
# Write the query
query <- with_qfuns(
  and(
    gte(patent_date = "2019-07-30"), # Dates are in yyyy-mm-dd format 
    text_phrase(assignees_at_grant.organization = "microsoft")
  )
)

# Create a field list
inv_fields <- get_fields(endpoint = "patents", groups = "inventors_at_grant")
fields <- c(inv_fields, "patent_number")

# Pull the data
pv_out <- search_pv(query, fields = fields, all_pages = TRUE)

# Unnest the inventor list column
unnest_pv_data(pv_out$data, "patent_number")
#> List of 2
#>  $ inventors_at_grant:'data.frame':	26710 obs. of  6 variables:
#>   ..$ patent_number: chr [1:26710] "10364598" ...
#>   ..$ name_first   : chr [1:26710] "Errol Mark" ...
#>   ..$ name_last    : chr [1:26710] "Tazbaz" ...
#>   ..$ city         : chr [1:26710] "Bellevue" ...
#>   ..$ state        : chr [1:26710] "WA" ...
#>   ..$ country      : chr [1:26710] "US" ...
#>  $ patents           :'data.frame':	6703 obs. of  1 variable:
#>   ..$ patent_number: chr [1:6703] "10364598" ...
```

Which inventors have Chicago, IL listed as their location on at least one patent.[^1]


```r
search_pv(
  query = '{"_and":[{"_text_phrase": {"inventors_at_grant.city":"Chicago"}},{"_text_phrase": {"inventors_at_grant.state":"IL"}}]}',
  endpoint = "patents"
)
#> $data
#> [1] "patents"
#> #### A list with a single data frame (with list column(s) inside) on a patent level:
#> 
#> List of 1
#>  $ patents:'data.frame':	25 obs. of  5 variables:
#>   ..$ patent_number     : chr [1:25] "4278694" ...
#>   ..$ patent_title      : chr [1:25] "Modified liquid smoke compositions and "..
#>   ..$ patent_date       : chr [1:25] "1981-07-14" ...
#>   ..$ assignees_at_grant:List of 25
#>   ..$ inventors_at_grant:List of 25
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 10,000
```

Which assignees have an interest in beer?


```r
search_pv(
  query = qry_funs$contains(patent_title = "beer"), 
  endpoint = "patents"
)
#> $data
#> [1] "patents"
#> #### A list with a single data frame (with list column(s) inside) on a patent level:
#> 
#> List of 1
#>  $ patents:'data.frame':	25 obs. of  5 variables:
#>   ..$ patent_number     : chr [1:25] "4299161" ...
#>   ..$ patent_title      : chr [1:25] "Ring and snap-on ring for preventing bu"..
#>   ..$ patent_date       : chr [1:25] "1981-11-10" ...
#>   ..$ assignees_at_grant:List of 25
#>   ..$ inventors_at_grant:List of 25
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 323
```

[^1]: Example taken from https://patentsview.org/apis/api-endpoints/inventors.
