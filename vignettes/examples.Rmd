---
title: "Examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



## Recent API Change

With the recent [API changes](api-changes.html), the patents endpoint is the main way to retrieve data. The other 
endpoints supply additional information.  Also note that an API key is required.

## Patents endpoint

Which patents have been cited by more than 500 US patents?


``` r
library(patentsview)

search_pv(query = qry_funs$gt(patent_num_times_cited_by_us_patents = 500))
#> $data
#> #### A list with a single data frame on patents level:
#> 
#> List of 1
#>  $ patents:'data.frame':	1000 obs. of  3 variables:
#>   ..$ patent_id   : chr [1:1000] "10004497" ...
#>   ..$ patent_title: chr [1:1000] "Interface systems for use with surgical ins"..
#>   ..$ patent_date : chr [1:1000] "2018-06-26" ...
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 13,199
```

How many distinct inventors are represented by these highly-cited patents?


``` r

search_pv(
  query = qry_funs$gt(patent_num_times_cited_by_us_patents = 500),
  fields = c("patent_id", "inventors.inventor_id")
)
#> $data
#> #### A list with a single data frame (with list column(s) inside) on patents level:
#> 
#> List of 1
#>  $ patents:'data.frame':	1000 obs. of  2 variables:
#>   ..$ patent_id: chr [1:1000] "10004497" ...
#>   ..$ inventors:List of 1000
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 13,199
```
What assignee's organizations start Microsoft?


``` r
query <- qry_funs$begins(assignee_organization = "Microsoft")

pv_out <- search_pv(query, endpoint = "assignee")
pv_out$data$assignees$assignee_organization
#>  [1] "Microsoft Technology Beaming, LLC"               
#>  [2] "MICROSOFT INTERNATIONAL HOLDINGS B.V."           
#>  [3] "Microsoft Mobile Oy"                             
#>  [4] "Microsoft Technology, LLC."                      
#>  [5] "Microsoft Systems Inc."                          
#>  [6] "Microsoft Technology Licensing, LLC"             
#>  [7] "Microsoft Corporation"                           
#>  [8] "Microsoft Patent Licensing, LLC"                 
#>  [9] "Microsoft Corporation—One Microsoft Way"         
#> [10] "Microsoft Licencing Corporation, LLC"            
#> [11] "Microsoft Mobile Internet AB"                    
#> [12] "Microsoft Licensing Technology, LLC"             
#> [13] "Microsoft Technology Learning, LLC"              
#> [14] "Microsoft Israel Research and Development (2002)"
#> [15] "Microsoft Orthopedics Holdings Inc."
```

Where geographically have Microsoft inventors been coming from over the past few years?

Note that the api currently returns no results for "Microsoft Corporation" but will return
"Microsoft Corporation", 
"Microsoft Corporation—One Microsoft Way"


``` r
# Write the query
query <- with_qfuns(
  and(
    gte(patent_date = "2022-07-26"), # Dates are in yyyy-mm-dd format
    begins(assignees.assignee_organization = "Microsoft")
  )
)

# Create a field list by getting the inventors fields
inv_fields <- get_fields(endpoint = "patent", groups="inventors")
# Pull the data
pv_out <- search_pv(query, fields = inv_fields, all_pages = TRUE, per_page = 1000)

# Unnest the inventor list column
unnest_pv_data(pv_out$data, "patent_id")
#> List of 2
#>  $ inventors:'data.frame':	14533 obs. of  8 variables:
#>   ..$ patent_id          : chr [1:14533] "11397055" ...
#>   ..$ inventor           : chr [1:14533] "https://search.patentsview.org/api/"..
#>   ..$ inventor_name_first: chr [1:14533] "Tzu-Yuan" ...
#>   ..$ inventor_name_last : chr [1:14533] "Lin" ...
#>   ..$ inventor_city      : chr [1:14533] "San Jose" ...
#>   ..$ inventor_state     : chr [1:14533] "CA" ...
#>   ..$ inventor_country   : chr [1:14533] "US" ...
#>   ..$ inventor_sequence  : int [1:14533] 1 2 ...
#>  $ patents  :'data.frame':	3600 obs. of  1 variable:
#>   ..$ patent_id: chr [1:3600] "11397055" ...
```

Which inventors have Chicago, IL listed as their location on at least one patent.[^1]


``` r
pv_out <- search_pv(
  query = '{"_and":[{"_text_phrase": {"inventors.inventor_city":"Chicago"}},{"_text_phrase": {"inventors.inventor_state":"IL"}}]}',
  endpoint = "patent"
)

pv_out
#> $data
#> #### A list with a single data frame on patents level:
#> 
#> List of 1
#>  $ patents:'data.frame':	1000 obs. of  3 variables:
#>   ..$ patent_id   : chr [1:1000] "10000578" ...
#>   ..$ patent_title: chr [1:1000] "Method for production of cellulose nanocrys"..
#>   ..$ patent_date : chr [1:1000] "2018-06-19" ...
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 46,544

if (pv_out$query_results$total_hits == 0) {
  print("something seems to be wrong with the API")
}
```

Which assignees have an interest in beer?


``` r
search_pv(
  query = qry_funs$contains(patent_title = "beer"),
  endpoint = "patent"
)
#> $data
#> #### A list with a single data frame on patents level:
#> 
#> List of 1
#>  $ patents:'data.frame':	592 obs. of  3 variables:
#>   ..$ patent_id   : chr [1:592] "10000326" ...
#>   ..$ patent_title: chr [1:592] "Plastic beer keg" ...
#>   ..$ patent_date : chr [1:592] "2018-06-19" ...
#> 
#> $query_results
#> #### Distinct entity counts across all downloadable pages of output:
#> 
#> total_hits = 592
```

[^1]: Example taken from https://patentsview.org/apis/api-endpoints/inventors.
