---
title: "Examples"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Recent API Change

With the recent api change, the patent endpoint is the main way to retrieve data. The other 
endpoints supply additional information.

## Patents endpoint

Which patents have been cited by more than 500 US patents?

```{r}
library(patentsview)

search_pv(query = qry_funs$gt(patent_num_times_cited_by_us_patents = 500))
```

How many distinct inventors are represented by these highly-cited patents?

```{r}
# Setting subent_cnts = TRUE will give us the subentity counts. Since inventors 
# are subentities for the patents endpoint, this means we will get their counts.
search_pv(
  query = qry_funs$gt(patent_num_times_cited_by_us_patents = 500),
  fields = c("patent_number", "inventors_at_grant.inventor"), 
  subent_cnts = TRUE
)
```

Where geographically have Microsoft inventors been coming from over the past few years?

```{r}
# Write the query
query <- with_qfuns(
  and(
    gte(patent_date = "2019-07-30"), # Dates are in yyyy-mm-dd format 
    text_phrase(assignees_at_grant.organization = "microsoft")
  )
)

# Create a field list
inv_fields <- get_fields(endpoint = "patents", groups = "inventors_at_grant")
fields <- c(inv_fields, "patent_number")

# Pull the data
pv_out <- search_pv(query, fields = fields, all_pages = TRUE)

# Unnest the inventor list column
unnest_pv_data(pv_out$data, "patent_number")
```

Which inventors have Chicago, IL listed as their location on at least one patent.[^1]

```{r}
search_pv(
  query = '{"_and":[{"_text_phrase": {"inventors_at_grant.city":"Chicago"}},{"_text_phrase": {"inventors_at_grant.state":"IL"}}]}',
  endpoint = "patents"
)
```

Which assignees have an interest in beer?

```{r}
search_pv(
  query = qry_funs$contains(patent_title = "beer"), 
  endpoint = "patents"
)
```

[^1]: Example taken from https://patentsview.org/apis/api-endpoints/inventors.
